<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>ESP-HLW8032-Meter电表制作</title>
    <url>/2022/06/18/esp-hlw8032-meter/</url>
    <content><![CDATA[<h1 id="ESP-HLW8032-Meter电表制作"><a href="#ESP-HLW8032-Meter电表制作" class="headerlink" title="ESP-HLW8032-Meter电表制作"></a>ESP-HLW8032-Meter电表制作</h1><h2 id="接入Home-Assistant效果"><a href="#接入Home-Assistant效果" class="headerlink" title="接入Home Assistant效果:"></a>接入Home Assistant效果:</h2><p><img src="./image-20220530011149190.png" alt="image-20220530011149190"></p>
<h2 id="硬件图"><a href="#硬件图" class="headerlink" title="硬件图:"></a>硬件图:</h2><p><img src="./image-20220530005707784.png" alt="image-20220530005707784"></p>
<p><img src="./image-20220530005750588.png" alt="image-20220530005750588"></p>
<p>加个外壳</p>
<p><img src="./image-20220530005939349.png" alt="image-20220530005939349"></p>
<h2 id="软件"><a href="#软件" class="headerlink" title="软件:"></a>软件:</h2><p>这是使用罗总框架实现数据获取</p>
<p><img src="./image-20220530010114917.png" alt="QQ图片20220530005818"></p>
<p>这是使用ESPHome实现数据获取</p>
<p><img src="./image-20220530010114916.png" alt="image-20220530010114916"></p>
<h2 id="资源"><a href="#资源" class="headerlink" title="资源:"></a>资源:</h2><p>HLW8032手册: <a href="HLW8032_C128023.pdf">HLW8032_C128023.pdf</a></p>
<p>BOM表和Gerber文件(厚度1.2mm):  <a href="ESP-HLW8032-b.zip">ESP-HLW8032-b.zip</a>  按键用15mm高度的 , 板厚1.2以下, 电阻:200k/0805 1k/0603 普通精度1% , 高精度用0.1%</p>
<p>罗总框架实现的固件:  </p>
<p>ESPHome实现的代码:  <a href="cse7766.yaml">cse7766.yaml</a></p>
<p>HTML BOM: <a href="ibom.html">ibom.html</a></p>
<p>开源协议: GPL 3.0</p>
<p>cse7766.yaml</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#################################################</span></span><br><span class="line">        <span class="comment">##CSE766 Energy V1.0##</span></span><br><span class="line"><span class="comment">######### 20220530 by MiWyf #####################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Your secrets.yaml</span></span><br><span class="line"><span class="comment">#  wifi_ssid: &#x27;ssid&#x27;    #WiFi_SSID名称</span></span><br><span class="line"><span class="comment">#  wifi_password: &#x27;12345678&#x27;    #WiFi密码</span></span><br><span class="line"><span class="comment">#  wifi_password_AP: &#x27;12345678&#x27;  #ap_WiFi密码</span></span><br><span class="line"><span class="comment">#  wifi_fast_connect: &#x27;false&#x27;   #如果SSID是隐藏的，设置为true</span></span><br><span class="line"><span class="comment">#  wifi_reboot_timeout: 60s  #WiFi离线多久后重启设备，秒s/分钟min/小时h，不需要此功能设置为0s</span></span><br><span class="line"><span class="comment">#  ota_password: &#x27;12345678&#x27;    #OTA密码</span></span><br><span class="line"><span class="comment">#  api_password: &#x27;12345678&#x27;    #OTA密码</span></span><br><span class="line"><span class="comment">#  api_reboot_timeout: 0s  #与客户端（如Home Assistant）失去连接多久后重启设备，秒s/分钟min/小时h，不需要此功能设置为0s</span></span><br><span class="line"><span class="comment">#  mqtt_reboot_timeout: 0s</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"></span><br><span class="line"><span class="attr">substitutions:</span></span><br><span class="line">  <span class="comment">#Name your Gateway</span></span><br><span class="line">  <span class="attr">device_name:</span> <span class="string">cse7766</span></span><br><span class="line">  <span class="comment">#Home Assistant Name</span></span><br><span class="line">  <span class="attr">friendly_name:</span> <span class="string">ESP</span> <span class="string">CSE7766</span></span><br><span class="line">  <span class="comment">#Secret YAML is used for next data:</span></span><br><span class="line">  <span class="attr">api_pw:</span> <span class="type">!secret</span> <span class="string">api_password</span></span><br><span class="line">  <span class="attr">ota_pw:</span> <span class="type">!secret</span> <span class="string">ota_password</span></span><br><span class="line"></span><br><span class="line"><span class="attr">esphome:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">$&#123;device_name&#125;</span></span><br><span class="line">  <span class="attr">platform:</span> <span class="string">ESP8266</span></span><br><span class="line">  <span class="attr">board:</span> <span class="string">esp01_1m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable logging</span></span><br><span class="line"><span class="comment">#logger:</span></span><br><span class="line"><span class="comment">#  level: DEBUG</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable Home Assistant API</span></span><br><span class="line"><span class="attr">api:</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">$&#123;api_pw&#125;</span></span><br><span class="line">  <span class="attr">reboot_timeout:</span> <span class="string">0s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable OTA</span></span><br><span class="line"><span class="attr">ota:</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">$&#123;ota_pw&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Enable WEB</span></span><br><span class="line"><span class="attr">web_server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable HA Time</span></span><br><span class="line"><span class="attr">time:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">homeassistant</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">homeassistant_time</span></span><br><span class="line"></span><br><span class="line"><span class="attr">wifi:</span></span><br><span class="line">  <span class="attr">ssid:</span> <span class="type">!secret</span> <span class="string">wifi_ssid</span></span><br><span class="line">  <span class="attr">password:</span> <span class="type">!secret</span> <span class="string">wifi_password</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Enable fallback hotspot (captive portal) in case wifi connection fails</span></span><br><span class="line">  <span class="attr">ap:</span></span><br><span class="line">    <span class="attr">ssid:</span> <span class="string">&quot;CSE7766&quot;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">&quot;12345678&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">captive_portal:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">status_led:</span></span><br><span class="line">  <span class="attr">pin:</span> <span class="string">GPIO16</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">#UART Settings</span></span><br><span class="line"><span class="attr">uart:</span></span><br><span class="line">  <span class="attr">rx_pin:</span> <span class="number">13</span></span><br><span class="line">  <span class="attr">baud_rate:</span> <span class="number">4800</span></span><br><span class="line">     </span><br><span class="line"><span class="attr">sensor:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">uptime</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">uptime_s</span></span><br><span class="line">    <span class="attr">update_interval:</span> <span class="string">60s</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">cse7766</span></span><br><span class="line">    <span class="comment">#update_interval: 15s</span></span><br><span class="line">    <span class="attr">current:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Current&quot;</span></span><br><span class="line">      <span class="attr">filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">lambda:</span> <span class="string">return</span> <span class="string">x;</span></span><br><span class="line">    <span class="attr">voltage:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Voltage&quot;</span></span><br><span class="line">      <span class="attr">filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">lambda:</span> <span class="string">return</span> <span class="string">x;</span></span><br><span class="line">    <span class="attr">power:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Power&quot;</span></span><br><span class="line">      <span class="attr">filters:</span></span><br><span class="line"><span class="comment">#        - sliding_window_moving_average:</span></span><br><span class="line"><span class="comment">#            window_size: 10</span></span><br><span class="line"><span class="comment">#            send_every: 10</span></span><br><span class="line"><span class="comment">#            send_first_at: 1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">lambda:</span> <span class="string">return</span> <span class="string">x;</span></span><br><span class="line">    <span class="attr">energy:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Energy&quot;</span></span><br><span class="line">      <span class="attr">unit_of_measurement:</span> <span class="string">kWh</span></span><br><span class="line">      <span class="attr">filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">lambda:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">            return x /1000;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="comment"># Extra sensor to keep track of gateway uptime</span></span><br><span class="line"><span class="attr">text_sensor:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">template</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Uptime&quot;</span></span><br><span class="line">    <span class="attr">lambda:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">      uint32_t dur = id(uptime_s).state;</span></span><br><span class="line"><span class="string">      int dys = 0;</span></span><br><span class="line"><span class="string">      int hrs = 0;</span></span><br><span class="line"><span class="string">      int mnts = 0;</span></span><br><span class="line"><span class="string">      if (dur &gt; 86399) &#123;</span></span><br><span class="line"><span class="string">        dys = trunc(dur / 86400);</span></span><br><span class="line"><span class="string">        dur = dur - (dys * 86400);</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      if (dur &gt; 3599) &#123;</span></span><br><span class="line"><span class="string">        hrs = trunc(dur / 3600);</span></span><br><span class="line"><span class="string">        dur = dur - (hrs * 3600);</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      if (dur &gt; 59) &#123;</span></span><br><span class="line"><span class="string">        mnts = trunc(dur / 60);</span></span><br><span class="line"><span class="string">        dur = dur - (mnts * 60);</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      char buffer[17];</span></span><br><span class="line"><span class="string">      sprintf(buffer, &quot;%ud %02uh %02um %02us&quot;, dys, hrs, mnts, dur);</span></span><br><span class="line"><span class="string">      return &#123;buffer&#125;;</span></span><br><span class="line"><span class="string"></span>    <span class="attr">icon:</span> <span class="string">mdi:clock-start</span></span><br><span class="line">    <span class="attr">update_interval:</span> <span class="string">60s</span></span><br><span class="line"></span><br><span class="line"><span class="attr">switch:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">restart</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Restart&quot;</span></span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>Smart Home</category>
      </categories>
      <tags>
        <tag>ESP8266</tag>
        <tag>HLW8032</tag>
        <tag>CSE7766</tag>
        <tag>Meter</tag>
        <tag>ESPHome</tag>
        <tag>Homeassistant</tag>
      </tags>
  </entry>
  <entry>
    <title>ESP-IM1266-Meter电表制作</title>
    <url>/2022/06/24/esp-im1266-meter/</url>
    <content><![CDATA[<h1 id="ESP-IM1266-Meter电表制作"><a href="#ESP-IM1266-Meter电表制作" class="headerlink" title="ESP-IM1266-Meter电表制作"></a>ESP-IM1266-Meter电表制作</h1><h2 id="接入Home-Assistant效果"><a href="#接入Home-Assistant效果" class="headerlink" title="接入Home Assistant效果:"></a>接入Home Assistant效果:</h2><p><img src="./image-20220530011149190.png" alt="image-20220530011149190"></p>
<h2 id="硬件图"><a href="#硬件图" class="headerlink" title="硬件图:"></a>硬件图:</h2><p><img src="./image-20220530005707784.png" alt="image-20220530005707784"></p>
<p><img src="./image-20220530005750588.png" alt="image-20220530005750588"></p>
<p>加个外壳</p>
<p><img src="./image-20220530005939349.png" alt="image-20220530005939349"></p>
<h2 id="软件"><a href="#软件" class="headerlink" title="软件:"></a>软件:</h2><p>这是使用罗总框架实现数据获取</p>
<p><img src="./image-20220530010114917.png" alt="QQ图片20220530005818"></p>
<p>这是使用ESPHome实现数据获取</p>
<p><img src="./image-20220530010114916.png" alt="image-20220530010114916"></p>
<p>接入homeassistant</p>
<p><img src="./image-20220530010114918.png" alt="img"></p>
<h2 id="资源"><a href="#资源" class="headerlink" title="资源:"></a>资源:</h2><p>IM1266手册: <a href="IM1266_C471615.pdf">IM1266_C471615.pdf</a></p>
<p>BOM表和Gerber文件:  <a href="EDP-IM1266-Meter.zip">EDP-IM1266-Meter.zip</a></p>
<p>罗总框架实现的固件:  <a href="esp8266_im1266_mb.bin">esp8266_im1266_mb.bin</a></p>
<p>ESPHome实现的代码:  <a href="im1266.yaml">im1266.yaml</a></p>
<p>开源协议: GPL 3.0</p>
<p>im1266.yaml</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#################################################</span></span><br><span class="line">        <span class="comment">##IM1266 Energy V1.0##</span></span><br><span class="line"><span class="comment">######### 20220528 by MiWyf #####################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Your secrets.yaml</span></span><br><span class="line"><span class="comment">#  wifi_ssid: &#x27;ssid&#x27;    #WiFi_SSID名称</span></span><br><span class="line"><span class="comment">#  wifi_password: &#x27;12345678&#x27;    #WiFi密码</span></span><br><span class="line"><span class="comment">#  wifi_password_AP: &#x27;12345678&#x27;  #ap_WiFi密码</span></span><br><span class="line"><span class="comment">#  wifi_fast_connect: &#x27;false&#x27;   #如果SSID是隐藏的，设置为true</span></span><br><span class="line"><span class="comment">#  wifi_reboot_timeout: 60s  #WiFi离线多久后重启设备，秒s/分钟min/小时h，不需要此功能设置为0s</span></span><br><span class="line"><span class="comment">#  ota_password: &#x27;12345678&#x27;    #OTA密码</span></span><br><span class="line"><span class="comment">#  api_password: &#x27;12345678&#x27;    #OTA密码</span></span><br><span class="line"><span class="comment">#  api_reboot_timeout: 0s  #与客户端（如Home Assistant）失去连接多久后重启设备，秒s/分钟min/小时h，不需要此功能设置为0s</span></span><br><span class="line"><span class="comment">#  mqtt_reboot_timeout: 0s</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"></span><br><span class="line"><span class="attr">substitutions:</span></span><br><span class="line">  <span class="comment">#Name your Gateway</span></span><br><span class="line">  <span class="attr">device_name:</span> <span class="string">im1266</span></span><br><span class="line">  <span class="comment">#Home Assistant Name</span></span><br><span class="line">  <span class="attr">friendly_name:</span> <span class="string">ESP</span> <span class="string">IM1266</span></span><br><span class="line">  <span class="comment">#Secret YAML is used for next data:</span></span><br><span class="line">  <span class="attr">api_pw:</span> <span class="type">!secret</span> <span class="string">api_password</span></span><br><span class="line">  <span class="attr">ota_pw:</span> <span class="type">!secret</span> <span class="string">ota_password</span></span><br><span class="line"></span><br><span class="line"><span class="attr">esphome:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">$&#123;device_name&#125;</span></span><br><span class="line">  <span class="attr">platform:</span> <span class="string">ESP8266</span></span><br><span class="line">  <span class="attr">board:</span> <span class="string">esp01_1m</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable logging</span></span><br><span class="line"><span class="comment">#logger:</span></span><br><span class="line">  <span class="comment">#level: DEBUG</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable Home Assistant API</span></span><br><span class="line"><span class="attr">api:</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">$&#123;api_pw&#125;</span></span><br><span class="line">  <span class="attr">reboot_timeout:</span> <span class="string">0s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable OTA</span></span><br><span class="line"><span class="attr">ota:</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">$&#123;ota_pw&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Enable WEB</span></span><br><span class="line"><span class="attr">web_server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable HA Time</span></span><br><span class="line"><span class="attr">time:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">homeassistant</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">homeassistant_time</span></span><br><span class="line"></span><br><span class="line"><span class="attr">wifi:</span></span><br><span class="line">  <span class="attr">ssid:</span> <span class="type">!secret</span> <span class="string">wifi_ssid</span></span><br><span class="line">  <span class="attr">password:</span> <span class="type">!secret</span> <span class="string">wifi_password</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Enable fallback hotspot (captive portal) in case wifi connection fails</span></span><br><span class="line">  <span class="attr">ap:</span></span><br><span class="line">    <span class="attr">ssid:</span> <span class="string">&quot;IM1266&quot;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">&quot;12345678&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">captive_portal:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">status_led:</span></span><br><span class="line">  <span class="attr">pin:</span> <span class="string">GPIO16</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#UART Settings</span></span><br><span class="line"><span class="attr">uart:</span></span><br><span class="line">  <span class="attr">id:</span> <span class="string">mod_bus</span></span><br><span class="line">  <span class="attr">tx_pin:</span> <span class="number">12</span></span><br><span class="line">  <span class="attr">rx_pin:</span> <span class="number">14</span></span><br><span class="line">  <span class="attr">baud_rate:</span> <span class="number">4800</span></span><br><span class="line">  <span class="attr">stop_bits:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">modbus:</span></span><br><span class="line">  <span class="attr">flow_control_pin:</span> <span class="number">13</span></span><br><span class="line">  <span class="attr">id:</span> <span class="string">modbus1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">modbus_controller:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">id:</span> <span class="string">epever</span></span><br><span class="line">    <span class="comment">## the Modbus device addr</span></span><br><span class="line">    <span class="attr">address:</span> <span class="number">0x1</span></span><br><span class="line">    <span class="attr">modbus_id:</span> <span class="string">modbus1</span></span><br><span class="line">    <span class="attr">setup_priority:</span> <span class="number">-10</span></span><br><span class="line"></span><br><span class="line"><span class="attr">sensor:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">uptime</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">uptime_s</span></span><br><span class="line">    <span class="attr">update_interval:</span> <span class="string">60s</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">modbus_controller</span></span><br><span class="line">    <span class="attr">modbus_controller_id:</span> <span class="string">epever</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Voltage&quot;</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">im1266_voltage</span></span><br><span class="line">    <span class="attr">register_type:</span> <span class="string">holding</span></span><br><span class="line">    <span class="attr">address:</span> <span class="number">0x0048</span></span><br><span class="line">    <span class="attr">unit_of_measurement:</span> <span class="string">&quot;V&quot;</span></span><br><span class="line">    <span class="attr">value_type:</span> <span class="string">U_DWORD</span></span><br><span class="line">    <span class="attr">accuracy_decimals:</span> <span class="number">4</span></span><br><span class="line">    <span class="attr">filters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">multiply:</span> <span class="number">0.0001</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">modbus_controller</span></span><br><span class="line">    <span class="attr">modbus_controller_id:</span> <span class="string">epever</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Current&quot;</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">im1266_current</span></span><br><span class="line">    <span class="attr">register_type:</span> <span class="string">holding</span></span><br><span class="line">    <span class="attr">address:</span> <span class="number">0x0049</span></span><br><span class="line">    <span class="attr">unit_of_measurement:</span> <span class="string">&quot;A&quot;</span></span><br><span class="line">    <span class="attr">value_type:</span> <span class="string">U_DWORD</span></span><br><span class="line">    <span class="attr">accuracy_decimals:</span> <span class="number">4</span></span><br><span class="line">    <span class="attr">filters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">multiply:</span> <span class="number">0.0001</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">modbus_controller</span></span><br><span class="line">    <span class="attr">modbus_controller_id:</span> <span class="string">epever</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Power&quot;</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">im1266_power</span></span><br><span class="line">    <span class="attr">register_type:</span> <span class="string">holding</span></span><br><span class="line">    <span class="attr">address:</span> <span class="number">0x004A</span></span><br><span class="line">    <span class="attr">unit_of_measurement:</span> <span class="string">&quot;W&quot;</span></span><br><span class="line">    <span class="attr">value_type:</span> <span class="string">U_DWORD</span></span><br><span class="line">    <span class="attr">accuracy_decimals:</span> <span class="number">4</span></span><br><span class="line">    <span class="attr">filters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">multiply:</span> <span class="number">0.0001</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">modbus_controller</span></span><br><span class="line">    <span class="attr">modbus_controller_id:</span> <span class="string">epever</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Energy&quot;</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">im1266_energy</span></span><br><span class="line">    <span class="attr">register_type:</span> <span class="string">holding</span></span><br><span class="line">    <span class="attr">address:</span> <span class="number">0x004B</span></span><br><span class="line">    <span class="attr">unit_of_measurement:</span> <span class="string">&quot;kWh&quot;</span></span><br><span class="line">    <span class="attr">value_type:</span> <span class="string">U_DWORD</span></span><br><span class="line">    <span class="attr">accuracy_decimals:</span> <span class="number">4</span></span><br><span class="line">    <span class="attr">filters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">multiply:</span> <span class="number">0.0001</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">modbus_controller</span></span><br><span class="line">    <span class="attr">modbus_controller_id:</span> <span class="string">epever</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; PF&quot;</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">im1266_pf</span></span><br><span class="line">    <span class="attr">register_type:</span> <span class="string">holding</span></span><br><span class="line">    <span class="attr">address:</span> <span class="number">0x004C</span></span><br><span class="line">    <span class="attr">unit_of_measurement:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">value_type:</span> <span class="string">U_DWORD</span></span><br><span class="line">    <span class="attr">accuracy_decimals:</span> <span class="number">3</span></span><br><span class="line">    <span class="attr">filters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">multiply:</span> <span class="number">0.001</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">modbus_controller</span></span><br><span class="line">    <span class="attr">modbus_controller_id:</span> <span class="string">epever</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; CO2&quot;</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">im1266_co2</span></span><br><span class="line">    <span class="attr">register_type:</span> <span class="string">holding</span></span><br><span class="line">    <span class="attr">address:</span> <span class="number">0x004D</span></span><br><span class="line">    <span class="attr">unit_of_measurement:</span> <span class="string">&quot;Kg&quot;</span></span><br><span class="line">    <span class="attr">value_type:</span> <span class="string">U_DWORD</span></span><br><span class="line">    <span class="attr">accuracy_decimals:</span> <span class="number">4</span></span><br><span class="line">    <span class="attr">filters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">multiply:</span> <span class="number">0.0001</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">modbus_controller</span></span><br><span class="line">    <span class="attr">modbus_controller_id:</span> <span class="string">epever</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Temprature&quot;</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">im1266_temprature</span></span><br><span class="line">    <span class="attr">register_type:</span> <span class="string">holding</span></span><br><span class="line">    <span class="attr">address:</span> <span class="number">0x004E</span></span><br><span class="line">    <span class="attr">unit_of_measurement:</span> <span class="string">&quot;°C&quot;</span></span><br><span class="line">    <span class="attr">value_type:</span> <span class="string">U_DWORD</span></span><br><span class="line">    <span class="attr">accuracy_decimals:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">filters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">multiply:</span> <span class="number">0.01</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">modbus_controller</span></span><br><span class="line">    <span class="attr">modbus_controller_id:</span> <span class="string">epever</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Frequency&quot;</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">im1266_frequency</span></span><br><span class="line">    <span class="attr">register_type:</span> <span class="string">holding</span></span><br><span class="line">    <span class="attr">address:</span> <span class="number">0x004F</span></span><br><span class="line">    <span class="attr">unit_of_measurement:</span> <span class="string">&quot;Hz&quot;</span></span><br><span class="line">    <span class="attr">value_type:</span> <span class="string">U_DWORD</span></span><br><span class="line">    <span class="attr">accuracy_decimals:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">filters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">multiply:</span> <span class="number">0.01</span></span><br><span class="line"></span><br><span class="line"><span class="attr">switch:</span></span><br><span class="line"><span class="comment">#  - platform: uart</span></span><br><span class="line"><span class="comment">#    name: &quot;UART String Output&quot;</span></span><br><span class="line"><span class="comment">#    data: &#x27;DataToSend&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">uart</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; clear10&quot;</span></span><br><span class="line">    <span class="attr">data:</span> [<span class="number">0x01</span>,<span class="number">0x10</span>,<span class="number">0x00</span>,<span class="number">0x4B</span>,<span class="number">0x00</span>,<span class="number">0x02</span>,<span class="number">0x04</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0xB6</span>,<span class="number">0x2C</span>]</span><br><span class="line">  <span class="comment">#- platform: modbus_controller</span></span><br><span class="line">    <span class="comment">#modbus_controller_id: epever</span></span><br><span class="line">    <span class="comment">#name: &quot;$&#123;friendly_name&#125; Clear&quot;</span></span><br><span class="line">    <span class="comment">#register_type: holding</span></span><br><span class="line">    <span class="comment">#address: 0x004B</span></span><br><span class="line">    <span class="comment">#bitmask: 0</span></span><br><span class="line">    <span class="comment">#true: 0x10, false:0x06</span></span><br><span class="line">    <span class="comment">#use_write_multiple: true</span></span><br><span class="line">    <span class="comment">#custom_command: [0x01,0x10,0x00,0x4B,0x00,0x02,0x04,0x00,0x00,0x00,0x00]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  - platform: uart</span></span><br><span class="line"><span class="comment">#    name: &quot;UART Recurring Output&quot;</span></span><br><span class="line"><span class="comment">#    data: [0xDE, 0xAD, 0xBE, 0xEF]</span></span><br><span class="line"><span class="comment">#    send_every: 1s</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">restart</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Restart&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># Extra sensor to keep track of gateway uptime</span></span><br><span class="line"><span class="attr">text_sensor:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">template</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Uptime&quot;</span></span><br><span class="line">    <span class="attr">lambda:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">      uint32_t dur = id(uptime_s).state;</span></span><br><span class="line"><span class="string">      int dys = 0;</span></span><br><span class="line"><span class="string">      int hrs = 0;</span></span><br><span class="line"><span class="string">      int mnts = 0;</span></span><br><span class="line"><span class="string">      if (dur &gt; 86399) &#123;</span></span><br><span class="line"><span class="string">        dys = trunc(dur / 86400);</span></span><br><span class="line"><span class="string">        dur = dur - (dys * 86400);</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      if (dur &gt; 3599) &#123;</span></span><br><span class="line"><span class="string">        hrs = trunc(dur / 3600);</span></span><br><span class="line"><span class="string">        dur = dur - (hrs * 3600);</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      if (dur &gt; 59) &#123;</span></span><br><span class="line"><span class="string">        mnts = trunc(dur / 60);</span></span><br><span class="line"><span class="string">        dur = dur - (mnts * 60);</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      char buffer[17];</span></span><br><span class="line"><span class="string">      sprintf(buffer, &quot;%ud %02uh %02um %02us&quot;, dys, hrs, mnts, dur);</span></span><br><span class="line"><span class="string">      return &#123;buffer&#125;;</span></span><br><span class="line"><span class="string"></span>    <span class="attr">icon:</span> <span class="string">mdi:clock-start</span></span><br><span class="line">    <span class="attr">update_interval:</span> <span class="string">60s</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>Smart Home</category>
      </categories>
      <tags>
        <tag>ESP8266</tag>
        <tag>Meter</tag>
        <tag>ESPHome</tag>
        <tag>Homeassistant</tag>
        <tag>IM1266</tag>
      </tags>
  </entry>
  <entry>
    <title>ESP-SmartPlug-Meter WiFi计量插座制作</title>
    <url>/2022/07/15/esp-smartplug-meter/</url>
    <content><![CDATA[<h1 id="ESP-SmartPlug-Meter-WiFi磁保持计量插座制作"><a href="#ESP-SmartPlug-Meter-WiFi磁保持计量插座制作" class="headerlink" title="ESP-SmartPlug-Meter WiFi磁保持计量插座制作"></a>ESP-SmartPlug-Meter WiFi磁保持计量插座制作</h1><h2 id="接入Home-Assistant效果"><a href="#接入Home-Assistant效果" class="headerlink" title="接入Home Assistant效果:"></a>接入Home Assistant效果:</h2><p><img src="./image-20220530011149190.png" alt="image-20220530011149190"></p>
<p><img src="./smartplug_ha.png" alt="image-smartplug_ha"></p>
<h2 id="硬件图"><a href="#硬件图" class="headerlink" title="硬件图:"></a>硬件图:</h2><p><img src="./image-20220715103230436.png" alt="image-20220715103230436"></p>
<p><img src="./image-20220715103336565.png" alt="image-20220715103336565"></p>
<p><img src="./image-20220715103355642.png" alt="image-20220715103355642"></p>
<h2 id="软件"><a href="#软件" class="headerlink" title="软件:"></a>软件:</h2><p>这是使用罗总框架实现数据获取</p>
<p>​    (暂时无)</p>
<p>这是使用ESPHome实现数据获取</p>
<p><img src="./image-20220715103438188.png" alt="image-20220715103438188"></p>
<h2 id="资源"><a href="#资源" class="headerlink" title="资源:"></a>资源:</h2><p>本项目改进自(保留磁保持继电器,wifi改为ESP-01M模块,AC-DC改为分立元件,添加计量检测,优化驱动引脚)：</p>
<p>1.[<a href="https://oshwhub.com/oldfox126/ci-bao-chi-wifi-zhi-neng-cha-zuo">已验证]磁保持WIFI智能插座(220V10A)</a></p>
<p>2.<a href="https://oshwhub.com/liyichuangeda/ji-yu-ESP12-de-shuang-lu-wu-xian-wu-lian-wang-kai-guan">【二次测试中】智能WiFi物联网插座</a></p>
<p>感谢作者 <a href="https://oshwhub.com/oldfox126">oldfox126</a>和<a href="https://oshwhub.com/liyichuangeda">御坂0x1BF52号</a> 大佬。</p>
<p>免责声明: 本设备为个人DIY研究使用,设备内220V电压,不对任何人复制制作产生的任何问题负责。</p>
<p>HLW8032手册: <a href="HLW8032_C128023.pdf">HLW8032_C128023.pdf</a></p>
<p>MD7620A手册: <a href="MD7620A_C920529.pdf">MD7620A_C920529.pdf</a></p>
<p>BP2525手册: <a href="BP2525.pdf">BP2525.pdf</a></p>
<h2 id="制作"><a href="#制作" class="headerlink" title="制作:"></a>制作:</h2><p>BOM表和Gerber文件(厚度1.0mm):  <a href="esp-smartplug-meter.zip">esp-smartplug-meter.zip</a>  按键用10-13mm高度的 , 板厚1.0, 电阻:200k/0805 1k/0603 普通精度1% , 高精度用0.1%</p>
<h3 id="相关元件来源-或者参考原作者连接-："><a href="#相关元件来源-或者参考原作者连接-：" class="headerlink" title="相关元件来源(或者参考原作者连接)："></a>相关元件来源(或者参考原作者连接)：</h3><ol>
<li>[插座外壳（包括里面的220V10A公母一体插座）] -&gt; <a href="https://detail.1688.com/offer/580420531460.html?spm=a261y.7663282.10811813088311.4.1317668c0RqiBd&sk=order">购买链接</a>。</li>
<li>侧按键（注意：要买H=5MM的）-&gt; <a href="https://item.taobao.com/item.htm?spm=a1z09.2.0.0.29ff2e8dNjtkJ3&id=572935746768&_u=h1l4mhjd0b5">购买链接</a></li>
<li>磁保持继电器K1（注意：要买HF3F-L-05-1HL1T(10A4脚)）-&gt; <a href="https://item.taobao.com/item.htm?spm=a1z09.2.0.0.29ff2e8dNjtkJ3&id=650943984858&_u=h1l4mhjb5a1">购买链接</a></li>
<li>磁保持继电器驱动芯片MD7620A SOT23-6 -&gt;<a href="https://item.taobao.com/item.htm?spm=a1z09.2.0.0.29ff2e8dNjtkJ3&id=665356397463&_u=h1l4mhje8c1">购买链接</a></li>
</ol>
<p>罗总框架实现的固件:  </p>
<p>ESPHome固件源码:  <a href="miwyf-cp1-am.yaml">miwyf-cp1-am.yaml</a></p>
<p>HTML BOM: <a href="ibom.html">ibom.html</a></p>
<p>开源协议: CC-BY-SA 3.0</p>
<p>miwyf-cp1-am.yaml</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#################################################</span></span><br><span class="line">        <span class="comment">##MiWyf CP1 AM V1.0##</span></span><br><span class="line"><span class="comment">######### 20220709 by MiWyf #####################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Your secrets.yaml</span></span><br><span class="line"><span class="comment">#  wifi_ssid: &#x27;ssid&#x27;    #WiFi_SSID名称</span></span><br><span class="line"><span class="comment">#  wifi_password: &#x27;12345678&#x27;    #WiFi密码</span></span><br><span class="line"><span class="comment">#  wifi_password_AP: &#x27;12345678&#x27;  #ap_WiFi密码</span></span><br><span class="line"><span class="comment">#  wifi_fast_connect: &#x27;false&#x27;   #如果SSID是隐藏的，设置为true</span></span><br><span class="line"><span class="comment">#  wifi_reboot_timeout: 60s  #WiFi离线多久后重启设备，秒s/分钟min/小时h，不需要此功能设置为0s</span></span><br><span class="line"><span class="comment">#  ota_password: &#x27;12345678&#x27;    #OTA密码</span></span><br><span class="line"><span class="comment">#  api_password: &#x27;12345678&#x27;    #OTA密码</span></span><br><span class="line"><span class="comment">#  api_reboot_timeout: 0s  #与客户端（如Home Assistant）失去连接多久后重启设备，秒s/分钟min/小时h，不需要此功能设置为0s</span></span><br><span class="line"><span class="comment">#  mqtt_reboot_timeout: 0s</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################</span></span><br><span class="line"></span><br><span class="line"><span class="attr">substitutions:</span></span><br><span class="line">  <span class="comment">#Name your Gateway</span></span><br><span class="line">  <span class="attr">device_name:</span> <span class="string">miwyf-cp1-am</span></span><br><span class="line">  <span class="comment">#Home Assistant Name</span></span><br><span class="line">  <span class="attr">friendly_name:</span> <span class="string">MiWyf</span> <span class="string">CP1</span> <span class="string">AM</span></span><br><span class="line">  <span class="comment">#Secret YAML is used for next data:</span></span><br><span class="line">  <span class="attr">api_pw:</span> <span class="type">!secret</span> <span class="string">api_password</span></span><br><span class="line">  <span class="attr">ota_pw:</span> <span class="type">!secret</span> <span class="string">ota_password</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#esphome:</span></span><br><span class="line"><span class="comment">#  name: $&#123;device_name&#125;</span></span><br><span class="line"><span class="comment">#  platform: ESP8266</span></span><br><span class="line"><span class="comment">#  board: esp01_1m</span></span><br><span class="line"><span class="comment">#  esp8266_restore_from_flash: true</span></span><br><span class="line"><span class="comment">#  #restore_from_flash: true</span></span><br><span class="line">  </span><br><span class="line"><span class="comment">##new mode</span></span><br><span class="line"><span class="attr">esphome:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">$&#123;device_name&#125;</span></span><br><span class="line">  <span class="comment">#platformio_options:</span></span><br><span class="line">    <span class="comment">#platform: https://github.com/platformio/platform-espressif32.git#feature/arduino-upstream</span></span><br><span class="line">    <span class="comment">#board_build.flash_mode: dio</span></span><br><span class="line"><span class="attr">esp8266:</span></span><br><span class="line">  <span class="attr">board:</span> <span class="string">esp01_1m</span></span><br><span class="line">  <span class="attr">framework:</span></span><br><span class="line">    <span class="attr">version:</span> <span class="string">recommended</span></span><br><span class="line">  <span class="attr">restore_from_flash:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment">#board_flash_mode: dio</span></span><br><span class="line">  <span class="comment">##for switch false</span></span><br><span class="line">  <span class="comment">#early_pin_init: false</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">preferences:</span></span><br><span class="line">  <span class="comment">#flash_write_interval: 1min</span></span><br><span class="line">  <span class="attr">flash_write_interval:</span> <span class="string">3s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable logging</span></span><br><span class="line"><span class="comment">#logger:</span></span><br><span class="line"><span class="comment">#  level: DEBUG</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable Home Assistant API</span></span><br><span class="line"><span class="attr">api:</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">$&#123;api_pw&#125;</span></span><br><span class="line">  <span class="attr">reboot_timeout:</span> <span class="string">0s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable OTA</span></span><br><span class="line"><span class="attr">ota:</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">$&#123;ota_pw&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Enable WEB</span></span><br><span class="line"><span class="attr">web_server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Enable HA Time</span></span><br><span class="line"><span class="attr">time:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">homeassistant</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">homeassistant_time</span></span><br><span class="line"></span><br><span class="line"><span class="attr">wifi:</span></span><br><span class="line">  <span class="attr">ssid:</span> <span class="type">!secret</span> <span class="string">wifi_ssid</span></span><br><span class="line">  <span class="attr">password:</span> <span class="type">!secret</span> <span class="string">wifi_password</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Enable fallback hotspot (captive portal) in case wifi connection fails</span></span><br><span class="line">  <span class="attr">ap:</span></span><br><span class="line">    <span class="attr">ssid:</span> <span class="string">&quot;$&#123;device_name&#125;&quot;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">&quot;12345678&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">captive_portal:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">status_led:</span></span><br><span class="line">  <span class="attr">pin:</span></span><br><span class="line">    <span class="attr">number:</span> <span class="string">GPIO2</span></span><br><span class="line">    <span class="attr">inverted:</span> <span class="literal">yes</span></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"><span class="attr">binary_sensor:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">gpio</span></span><br><span class="line">    <span class="attr">pin:</span></span><br><span class="line">      <span class="attr">number:</span> <span class="string">GPIO0</span></span><br><span class="line">      <span class="attr">mode:</span></span><br><span class="line">        <span class="attr">input:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">pullup:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">inverted:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Button&quot;</span></span><br><span class="line">    <span class="attr">on_press:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">switch.toggle:</span> <span class="string">relay</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">status</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Status&quot;</span></span><br><span class="line"><span class="comment">#  - platform: gpio</span></span><br><span class="line"><span class="comment">#    pin: GPIO2</span></span><br><span class="line"><span class="comment">#    name: &quot;$&#123;friendly_name&#125; Sensor&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">switch:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">gpio</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Relay&quot;</span></span><br><span class="line">    <span class="attr">pin:</span> <span class="string">GPIO13</span></span><br><span class="line">    <span class="attr">inverted:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">relay</span></span><br><span class="line">    <span class="attr">on_turn_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">switch.turn_off:</span> <span class="string">ina</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">switch.turn_on:</span> <span class="string">inb</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">delay:</span> <span class="string">100ms</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">switch.turn_off:</span> <span class="string">ina</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">switch.turn_off:</span> <span class="string">inb</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">delay:</span> <span class="string">100ms</span></span><br><span class="line">    <span class="attr">on_turn_off:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">switch.turn_on:</span> <span class="string">ina</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">switch.turn_off:</span> <span class="string">inb</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">delay:</span> <span class="string">100ms</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">switch.turn_off:</span> <span class="string">ina</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">switch.turn_off:</span> <span class="string">inb</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">delay:</span> <span class="string">100ms</span></span><br><span class="line">    </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">gpio</span></span><br><span class="line">    <span class="attr">pin:</span> <span class="string">GPIO5</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">ina</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">gpio</span></span><br><span class="line">    <span class="attr">pin:</span> <span class="string">GPIO4</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">inb</span></span><br><span class="line">    </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">template</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Energy Reset&quot;</span></span><br><span class="line">    <span class="attr">icon:</span> <span class="string">&quot;mdi:switch&quot;</span></span><br><span class="line">    <span class="attr">optimistic:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">energy_reset</span></span><br><span class="line">    <span class="comment">#turn_off_action:</span></span><br><span class="line">      <span class="comment">#- sensor.integration.reset:  my_total_daily_energy </span></span><br><span class="line">    <span class="attr">turn_on_action:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">sensor.integration.reset:</span> <span class="string">my_total_energy</span> </span><br><span class="line">    </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">restart</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Restart&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#UART Settings</span></span><br><span class="line"><span class="attr">uart:</span></span><br><span class="line">  <span class="attr">rx_pin:</span> <span class="number">14</span></span><br><span class="line">  <span class="attr">baud_rate:</span> <span class="number">4800</span></span><br><span class="line">     </span><br><span class="line"><span class="attr">sensor:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">uptime</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">uptime_s</span></span><br><span class="line">    <span class="attr">update_interval:</span> <span class="string">60s</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">total_daily_energy</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">my_total_daily_energy</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Total Daily Energy&quot;</span></span><br><span class="line">    <span class="attr">power_id:</span> <span class="string">my_power</span></span><br><span class="line">    <span class="attr">filters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">multiply:</span> <span class="number">0.001</span></span><br><span class="line">    <span class="attr">unit_of_measurement:</span> <span class="string">kWh</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">integration</span></span><br><span class="line">    <span class="attr">id:</span> <span class="string">my_total_energy</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Total Energy&quot;</span> </span><br><span class="line">    <span class="attr">sensor:</span> <span class="string">my_power</span></span><br><span class="line">    <span class="attr">filters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">multiply:</span> <span class="number">0.001</span></span><br><span class="line">    <span class="attr">unit_of_measurement:</span> <span class="string">kWh</span></span><br><span class="line">    <span class="attr">time_unit:</span> <span class="string">h</span></span><br><span class="line">    <span class="attr">restore:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">min_save_interval:</span> <span class="string">60s</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">cse7766</span></span><br><span class="line">    <span class="attr">update_interval:</span> <span class="string">10s</span></span><br><span class="line">    <span class="attr">current:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Current&quot;</span></span><br><span class="line">    <span class="attr">voltage:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Voltage&quot;</span></span><br><span class="line">    <span class="attr">power:</span></span><br><span class="line">      <span class="attr">id:</span> <span class="string">my_power</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Power&quot;</span></span><br><span class="line">      <span class="attr">filters:</span></span><br><span class="line"><span class="comment">#        - sliding_window_moving_average:</span></span><br><span class="line"><span class="comment">#            window_size: 10</span></span><br><span class="line"><span class="comment">#            send_every: 10</span></span><br><span class="line"><span class="comment">#            send_first_at: 1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">lambda:</span> <span class="string">return</span> <span class="string">x;</span></span><br><span class="line">    <span class="attr">energy:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Energy&quot;</span></span><br><span class="line">      <span class="attr">unit_of_measurement:</span> <span class="string">kWh</span></span><br><span class="line">      <span class="attr">filters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">multiply:</span> <span class="number">0.001</span>          </span><br><span class="line">            </span><br><span class="line"><span class="comment"># Extra sensor to keep track of gateway uptime</span></span><br><span class="line"><span class="attr">text_sensor:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">platform:</span> <span class="string">template</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;$&#123;friendly_name&#125; Uptime&quot;</span></span><br><span class="line">    <span class="attr">lambda:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">      uint32_t dur = id(uptime_s).state;</span></span><br><span class="line"><span class="string">      int dys = 0;</span></span><br><span class="line"><span class="string">      int hrs = 0;</span></span><br><span class="line"><span class="string">      int mnts = 0;</span></span><br><span class="line"><span class="string">      if (dur &gt; 86399) &#123;</span></span><br><span class="line"><span class="string">        dys = trunc(dur / 86400);</span></span><br><span class="line"><span class="string">        dur = dur - (dys * 86400);</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      if (dur &gt; 3599) &#123;</span></span><br><span class="line"><span class="string">        hrs = trunc(dur / 3600);</span></span><br><span class="line"><span class="string">        dur = dur - (hrs * 3600);</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      if (dur &gt; 59) &#123;</span></span><br><span class="line"><span class="string">        mnts = trunc(dur / 60);</span></span><br><span class="line"><span class="string">        dur = dur - (mnts * 60);</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      char buffer[17];</span></span><br><span class="line"><span class="string">      sprintf(buffer, &quot;%ud %02uh %02um %02us&quot;, dys, hrs, mnts, dur);</span></span><br><span class="line"><span class="string">      return &#123;buffer&#125;;</span></span><br><span class="line"><span class="string"></span>    <span class="attr">icon:</span> <span class="string">mdi:clock-start</span></span><br><span class="line">    <span class="attr">update_interval:</span> <span class="string">60s</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>Smart Home</category>
      </categories>
      <tags>
        <tag>ESP8266</tag>
        <tag>HLW8032</tag>
        <tag>CSE7766</tag>
        <tag>Meter</tag>
        <tag>ESPHome</tag>
        <tag>Homeassistant</tag>
        <tag>SmartPlug</tag>
      </tags>
  </entry>
  <entry>
    <title>ha-ui-apexcharts-card HomeAssistant超级漂亮的界面</title>
    <url>/2022/07/25/ha-ui-apexcharts-card/</url>
    <content><![CDATA[<h1 id="HomeAssistant超级漂亮的界面"><a href="#HomeAssistant超级漂亮的界面" class="headerlink" title="HomeAssistant超级漂亮的界面"></a>HomeAssistant超级漂亮的界面</h1><h2 id="接入Home-Assistant效果"><a href="#接入Home-Assistant效果" class="headerlink" title="接入Home Assistant效果:"></a>接入Home Assistant效果:</h2><p><img src="./image-20220530011149190.png" alt="image-20220530011149190"></p>
<h2 id="安装插件"><a href="#安装插件" class="headerlink" title="安装插件:"></a>安装插件:</h2><p>插件项目地址:<a href="https://github.com/RomRider/apexcharts-card">RomRider/apexcharts-card: 📈 A Lovelace card to display advanced graphs and charts based on ApexChartsJS for Home Assistant (github.com)</a></p>
<p>首先安装apexcharts-card插件,你可以直接安装也可以通过hacs</p>
<p><img src="./image-20220725085328695.png" alt="image-20220725085328695"></p>
<h2 id="界面UI"><a href="#界面UI" class="headerlink" title="界面UI:"></a>界面UI:</h2><p>卡片的配置</p>
<p>1-1</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">type:</span> <span class="string">custom:apexcharts-card</span></span><br><span class="line"><span class="attr">experimental:</span></span><br><span class="line">  <span class="attr">color_threshold:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">graph_span:</span> <span class="string">24h</span></span><br><span class="line"><span class="attr">show:</span></span><br><span class="line">  <span class="attr">last_updated:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">header:</span></span><br><span class="line">  <span class="attr">standard_format:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">show:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">show_states:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">colorize_states:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Living</span> <span class="string">Room</span> <span class="string">Temperature</span></span><br><span class="line"><span class="attr">now:</span></span><br><span class="line">  <span class="attr">show:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">red</span></span><br><span class="line">  <span class="attr">label:</span> <span class="string">Now</span></span><br><span class="line"><span class="attr">series:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.weather_temperature</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">室外温度</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">line</span></span><br><span class="line">    <span class="attr">group_by:</span></span><br><span class="line">      <span class="attr">func:</span> <span class="string">last</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">5m</span></span><br><span class="line">    <span class="attr">stroke_width:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">show:</span></span><br><span class="line">      <span class="attr">extremas:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">header_color_threshold:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">color_threshold:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">value:</span> <span class="number">18</span></span><br><span class="line">        <span class="attr">color:</span> <span class="string">steelblue</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">value:</span> <span class="number">21</span></span><br><span class="line">        <span class="attr">color:</span> <span class="string">midnightblue</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">value:</span> <span class="number">22</span></span><br><span class="line">        <span class="attr">color:</span> <span class="string">orange</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">value:</span> <span class="number">23</span></span><br><span class="line">        <span class="attr">color:</span> <span class="string">orangered</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">value:</span> <span class="number">26</span></span><br><span class="line">        <span class="attr">color:</span> <span class="string">red</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.weather_humidity</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">室外湿度</span></span><br><span class="line">    <span class="attr">stroke_width:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">show:</span></span><br><span class="line">      <span class="attr">in_chart:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.0xa4c1380a60008845_temperature</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">客厅温度</span></span><br><span class="line">    <span class="attr">stroke_width:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">show:</span></span><br><span class="line">      <span class="attr">extremas:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">header_color_threshold:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.0xa4c1380a60008845_humidity</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">客厅湿度</span></span><br><span class="line">    <span class="attr">stroke_width:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">show:</span></span><br><span class="line">      <span class="attr">in_chart:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>1-2</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">type:</span> <span class="string">custom:apexcharts-card</span></span><br><span class="line"><span class="attr">experimental:</span></span><br><span class="line">  <span class="attr">color_threshold:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">graph_span:</span> <span class="string">24h</span></span><br><span class="line"><span class="attr">show:</span></span><br><span class="line">  <span class="attr">last_updated:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">header:</span></span><br><span class="line">  <span class="attr">standard_format:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">show:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">show_states:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">colorize_states:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Home</span> <span class="string">Energy</span></span><br><span class="line"><span class="attr">now:</span></span><br><span class="line">  <span class="attr">show:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">red</span></span><br><span class="line">  <span class="attr">label:</span> <span class="string">Now</span></span><br><span class="line"><span class="attr">span:</span></span><br><span class="line">  <span class="attr">end:</span> <span class="string">hour</span></span><br><span class="line"><span class="attr">series:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.meter_power</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">总表</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">line</span></span><br><span class="line">    <span class="attr">group_by:</span></span><br><span class="line">      <span class="attr">func:</span> <span class="string">avg</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">5m</span></span><br><span class="line">    <span class="attr">stroke_width:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">show:</span></span><br><span class="line">      <span class="attr">extremas:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">header_color_threshold:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">color_threshold:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">value:</span> <span class="number">100</span></span><br><span class="line">        <span class="attr">color:</span> <span class="string">steelblue</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">value:</span> <span class="number">800</span></span><br><span class="line">        <span class="attr">color:</span> <span class="string">midnightblue</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">value:</span> <span class="number">1500</span></span><br><span class="line">        <span class="attr">color:</span> <span class="string">orange</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">value:</span> <span class="number">2000</span></span><br><span class="line">        <span class="attr">color:</span> <span class="string">orangered</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">value:</span> <span class="number">3000</span></span><br><span class="line">        <span class="attr">color:</span> <span class="string">red</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.relay_2053cd_power</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">客厅</span></span><br><span class="line">    <span class="attr">stroke_width:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">group_by:</span></span><br><span class="line">      <span class="attr">func:</span> <span class="string">avg</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">5min</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.relay_ecf998_power</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">书房</span></span><br><span class="line">    <span class="attr">stroke_width:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">show:</span></span><br><span class="line">      <span class="attr">in_chart:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">group_by:</span></span><br><span class="line">      <span class="attr">func:</span> <span class="string">avg</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">5min</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.plug_158d0001b19931_power</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">冰箱</span></span><br><span class="line">    <span class="attr">stroke_width:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">show:</span></span><br><span class="line">      <span class="attr">in_chart:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">group_by:</span></span><br><span class="line">      <span class="attr">func:</span> <span class="string">avg</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">5min</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.cabinet_meter_power</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">机柜</span></span><br><span class="line">    <span class="attr">stroke_width:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">show:</span></span><br><span class="line">      <span class="attr">in_chart:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">group_by:</span></span><br><span class="line">      <span class="attr">func:</span> <span class="string">avg</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">5min</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.server_power</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">R730XD</span></span><br><span class="line">    <span class="attr">stroke_width:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">show:</span></span><br><span class="line">      <span class="attr">in_chart:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">extremas:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">header_color_threshold:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">group_by:</span></span><br><span class="line">      <span class="attr">func:</span> <span class="string">avg</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">5min</span></span><br></pre></td></tr></table></figure>

<p>1-3</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">type:</span> <span class="string">custom:apexcharts-card</span></span><br><span class="line"><span class="attr">apex_config:</span></span><br><span class="line">  <span class="attr">chart:</span></span><br><span class="line">    <span class="attr">stacked:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">graph_span:</span> <span class="string">14d</span></span><br><span class="line"><span class="attr">span:</span></span><br><span class="line">  <span class="attr">end:</span> <span class="string">day</span></span><br><span class="line"><span class="attr">show:</span></span><br><span class="line">  <span class="attr">last_updated:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">header:</span></span><br><span class="line">  <span class="attr">show:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">show_states:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">colorize_states:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">每日电费</span></span><br><span class="line"><span class="attr">series:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.meter_energy_daily_money</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">总表</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">column</span></span><br><span class="line">    <span class="attr">color:</span> <span class="string">darkviolet</span></span><br><span class="line">    <span class="attr">group_by:</span></span><br><span class="line">      <span class="attr">func:</span> <span class="string">max</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">1d</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.relay_2053cd_daily_money</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">客厅</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">column</span></span><br><span class="line">    <span class="attr">color:</span> <span class="string">slateblue</span></span><br><span class="line">    <span class="attr">group_by:</span></span><br><span class="line">      <span class="attr">func:</span> <span class="string">max</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">1d</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.relay_ecf998_daily_money</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">书房</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">column</span></span><br><span class="line">    <span class="attr">color:</span> <span class="string">orangered</span></span><br><span class="line">    <span class="attr">group_by:</span></span><br><span class="line">      <span class="attr">func:</span> <span class="string">max</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">1d</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.plug_158d0001b19931_energy_daily_money</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">冰箱</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">column</span></span><br><span class="line">    <span class="attr">color:</span> <span class="string">orangered</span></span><br><span class="line">    <span class="attr">group_by:</span></span><br><span class="line">      <span class="attr">func:</span> <span class="string">max</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">1d</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.cabinet_meter_energy_daily_money</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">机柜</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">column</span></span><br><span class="line">    <span class="attr">color:</span> <span class="string">orangered</span></span><br><span class="line">    <span class="attr">group_by:</span></span><br><span class="line">      <span class="attr">func:</span> <span class="string">max</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">1d</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.server_powerusage_daily_money</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">R730XD</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">column</span></span><br><span class="line">    <span class="attr">color:</span> <span class="string">orangered</span></span><br><span class="line">    <span class="attr">group_by:</span></span><br><span class="line">      <span class="attr">func:</span> <span class="string">max</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">1d</span></span><br></pre></td></tr></table></figure>

<p>2-1</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">type:</span> <span class="string">custom:apexcharts-card</span></span><br><span class="line"><span class="attr">chart_type:</span> <span class="string">pie</span></span><br><span class="line"><span class="attr">header:</span></span><br><span class="line">  <span class="attr">show:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">show_states:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">colorize_states:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Monthly</span> <span class="string">Energy</span> <span class="string">consumption</span> <span class="string">in</span> <span class="string">kWh</span></span><br><span class="line"><span class="attr">series:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.relay_2053cd_monthly</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">客厅</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.relay_ecf998_monthly</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">书房</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.plug_158d0001b19931_energy_monthly</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">冰箱</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.cabinet_meter_energy_monthly</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">机柜</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.server_powerusage_monthly</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">R730XD</span></span><br></pre></td></tr></table></figure>

<p>2-2</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">type:</span> <span class="string">custom:apexcharts-card</span></span><br><span class="line"><span class="attr">experimental:</span></span><br><span class="line">  <span class="attr">color_threshold:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">graph_span:</span> <span class="string">24h</span></span><br><span class="line"><span class="attr">show:</span></span><br><span class="line">  <span class="attr">last_updated:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">header:</span></span><br><span class="line">  <span class="attr">standard_format:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">show:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">show_states:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">colorize_states:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Dell</span> <span class="string">PowerEdge</span> <span class="string">R730xd</span></span><br><span class="line"><span class="attr">now:</span></span><br><span class="line">  <span class="attr">show:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">color:</span> <span class="string">red</span></span><br><span class="line">  <span class="attr">label:</span> <span class="string">Now</span></span><br><span class="line"><span class="attr">series:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.server_fans_speed_avg</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">机箱风扇</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">line</span></span><br><span class="line">    <span class="attr">group_by:</span></span><br><span class="line">      <span class="attr">func:</span> <span class="string">last</span></span><br><span class="line">      <span class="attr">duration:</span> <span class="string">5m</span></span><br><span class="line">    <span class="attr">stroke_width:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">show:</span></span><br><span class="line">      <span class="attr">extremas:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">header_color_threshold:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">color_threshold:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">value:</span> <span class="number">18</span></span><br><span class="line">        <span class="attr">color:</span> <span class="string">steelblue</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">value:</span> <span class="number">21</span></span><br><span class="line">        <span class="attr">color:</span> <span class="string">midnightblue</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">value:</span> <span class="number">22</span></span><br><span class="line">        <span class="attr">color:</span> <span class="string">orange</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">value:</span> <span class="number">23</span></span><br><span class="line">        <span class="attr">color:</span> <span class="string">orangered</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">value:</span> <span class="number">26</span></span><br><span class="line">        <span class="attr">color:</span> <span class="string">red</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.rawdellserverfan1</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">fan1</span></span><br><span class="line">    <span class="attr">stroke_width:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">show:</span></span><br><span class="line">      <span class="attr">in_chart:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.rawdellserverfan2</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">fan2</span></span><br><span class="line">    <span class="attr">stroke_width:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">show:</span></span><br><span class="line">      <span class="attr">extremas:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">header_color_threshold:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.rawdellserverfan3</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">fan3</span></span><br><span class="line">    <span class="attr">stroke_width:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">show:</span></span><br><span class="line">      <span class="attr">in_chart:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.rawdellserverfan4</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">fan4</span></span><br><span class="line">    <span class="attr">stroke_width:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">show:</span></span><br><span class="line">      <span class="attr">in_chart:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.rawdellserverfan5</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">fan5</span></span><br><span class="line">    <span class="attr">stroke_width:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">show:</span></span><br><span class="line">      <span class="attr">in_chart:</span> <span class="literal">true</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.rawdellserverfan6</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">fan6</span></span><br><span class="line">    <span class="attr">stroke_width:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">show:</span></span><br><span class="line">      <span class="attr">in_chart:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>2-3</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">type:</span> <span class="string">custom:apexcharts-card</span></span><br><span class="line"><span class="attr">header:</span></span><br><span class="line">  <span class="attr">show:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">R730XD</span> <span class="string">Temperature</span> <span class="string">Levels</span></span><br><span class="line">  <span class="attr">show_states:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">colorize_states:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">chart_type:</span> <span class="string">radialBar</span></span><br><span class="line"><span class="attr">series:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.server_cpu1_temperature</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">CPU1温度</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.server_cpu2_temperature</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">CPU2温度</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.server_inlet_temperature</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">入口温度</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">entity:</span> <span class="string">sensor.server_exhaust_temperature</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">出口温度</span></span><br></pre></td></tr></table></figure>



<h2 id="资源"><a href="#资源" class="headerlink" title="资源:"></a>资源:</h2><p>1.HACS:<a href="https://github.com/hacs">HACS (github.com)</a></p>
<p>2.apexcharts-card: <a href="https://github.com/RomRider/apexcharts-card">RomRider/apexcharts-card: 📈 A Lovelace card to display advanced graphs and charts based on ApexChartsJS for Home Assistant (github.com)</a></p>
<p>开源协议: 请遵循原作者的开源协议</p>
]]></content>
      <categories>
        <category>Smart Home</category>
        <category>Home Assistant</category>
      </categories>
      <tags>
        <tag>Homeassistant</tag>
        <tag>Home Assistant</tag>
        <tag>apexcharts-card</tag>
        <tag>hacs</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2022/07/28/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<span id="more"></span>

<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>
]]></content>
  </entry>
  <entry>
    <title>kms</title>
    <url>/2021/11/12/kms/</url>
    <content><![CDATA[<h1 id="kms-server-docker-image"><a href="#kms-server-docker-image" class="headerlink" title="kms server docker image"></a>kms server docker image</h1><h2 id="地址："><a href="#地址：" class="headerlink" title="地址："></a>地址：</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://hub.docker.com/r/luodaoyi/kms-server</span><br></pre></td></tr></table></figure>

<h2 id="KMS激活使用方法"><a href="#KMS激活使用方法" class="headerlink" title="KMS激活使用方法"></a>KMS激活使用方法</h2><p>一般来说，只要确保的下载的是VL批量版本并且没有手动安装过任何key， 你只需要使用管理员权限运行cmd执行一句命令就足够：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">slmgr /skms kms.luody.info</span><br></pre></td></tr></table></figure>

<p>然后去计算机属性或者控制面板其他的什么的地方点一下激活就好了。</p>
<p>当然，如果你懒得点，可以多打一句命令手动激活：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">slmgr /ato</span><br></pre></td></tr></table></figure>

<p>这句命令的意思是，马上对当前设置的key和服务器地址等进行尝试激活操作。</p>
<p>kms激活的前提是你的系统是批量授权版本，即VL版，一般企业版都是VL版，专业版有零售和VL版，家庭版旗舰版OEM版等等那就肯定不能用kms激活。一般建议从<a href="http://msdn.itellyou.cn/">http://msdn.itellyou.cn</a>上面下载系统 VL版本的镜像一般内置GVLK key，用于kms激活。如果你手动输过其他key，那么这个内置的key就会被替换掉，这个时候如果你想用kms，那么就需要把GVLK key输回去。首先， 到<a href="https://technet.microsoft.com/en-us/library/jj612867.aspx">https://technet.microsoft.com/en-us/library/jj612867.aspx</a> 获取你对应版本的KEY 如果打不开下面有对应的</p>
<p>如果不知道自己的系统是什么版本，可以运行以下命令查看系统版本：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wmic os get caption</span><br></pre></td></tr></table></figure>

<p>得到对应key之后，使用管理员权限运行cmd执行安装key：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">slmgr /ipk xxxxx-xxxxx-xxxxx-xxxxx</span><br></pre></td></tr></table></figure>

<p>然后跟上面说的一样设置kms服务器地址，激活。</p>
<h1 id="Windows-GVLK密钥对照表（KMS激活专用）"><a href="#Windows-GVLK密钥对照表（KMS激活专用）" class="headerlink" title="Windows GVLK密钥对照表（KMS激活专用）"></a>Windows GVLK密钥对照表（KMS激活专用）</h1><blockquote>
<p>以下key来源于微软官网：<a href="https://technet.microsoft.com/en-us/library/jj612867.aspx">https://technet.microsoft.com/en-us/library/jj612867.aspx</a></p>
</blockquote>
<h2 id="Windows-Server-2016"><a href="#Windows-Server-2016" class="headerlink" title="Windows Server 2016"></a>Windows Server 2016</h2><table>
<thead>
<tr>
<th>操作系统</th>
<th>KMS激活序列号</th>
</tr>
</thead>
<tbody><tr>
<td>Windows Server 2016 Datacenter</td>
<td>CB7KF-BWN84-R7R2Y-793K2-8XDDG</td>
</tr>
<tr>
<td>Windows Server 2016 Standard</td>
<td>WC2BQ-8NRM3-FDDYY-2BFGV-KHKQY</td>
</tr>
<tr>
<td>Windows Server 2016 Essentials</td>
<td>JCKRF-N37P4-C2D82-9YXRT-4M63B</td>
</tr>
</tbody></table>
<h2 id="Windows-10"><a href="#Windows-10" class="headerlink" title="Windows 10"></a>Windows 10</h2><table>
<thead>
<tr>
<th>操作系统</th>
<th>KMS激活序列号</th>
</tr>
</thead>
<tbody><tr>
<td>Windows 10 Professional</td>
<td>W269N-WFGWX-YVC9B-4J6C9-T83GX</td>
</tr>
<tr>
<td>Windows 10 Professional N</td>
<td>MH37W-N47XK-V7XM9-C7227-GCQG9</td>
</tr>
<tr>
<td>Windows 10 Enterprise</td>
<td>NPPR9-FWDCX-D2C8J-H872K-2YT43</td>
</tr>
<tr>
<td>Windows 10 Enterprise N</td>
<td>DPH2V-TTNVB-4X9Q3-TJR4H-KHJW4</td>
</tr>
<tr>
<td>Windows 10 Education</td>
<td>NW6C2-QMPVW-D7KKK-3GKT6-VCFB2</td>
</tr>
<tr>
<td>Windows 10 Education N</td>
<td>2WH4N-8QGBV-H22JP-CT43Q-MDWWJ</td>
</tr>
<tr>
<td>Windows 10 Enterprise 2015 LTSB</td>
<td>WNMTR-4C88C-JK8YV-HQ7T2-76DF9</td>
</tr>
<tr>
<td>Windows 10 Enterprise 2015 LTSB N</td>
<td>2F77B-TNFGY-69QQF-B8YKP-D69TJ</td>
</tr>
<tr>
<td>Windows 10 Enterprise 2016 LTSB</td>
<td>DCPHK-NFMTC-H88MJ-PFHPY-QJ4BJ</td>
</tr>
<tr>
<td>Windows 10 Enterprise 2016 LTSB N</td>
<td>QFFDN-GRT3P-VKWWX-X7T3R-8B639</td>
</tr>
</tbody></table>
<h2 id="Windows-Server-2012-R2-和-Windows-8-1"><a href="#Windows-Server-2012-R2-和-Windows-8-1" class="headerlink" title="Windows Server 2012 R2 和 Windows 8.1"></a>Windows Server 2012 R2 和 Windows 8.1</h2><table>
<thead>
<tr>
<th>操作系统</th>
<th>KMS激活序列号</th>
</tr>
</thead>
<tbody><tr>
<td>Windows 8.1 Professional</td>
<td>GCRJD-8NW9H-F2CDX-CCM8D-9D6T9</td>
</tr>
<tr>
<td>Windows 8.1 Professional N</td>
<td>HMCNV-VVBFX-7HMBH-CTY9B-B4FXY</td>
</tr>
<tr>
<td>Windows 8.1 Enterprise</td>
<td>MHF9N-XY6XB-WVXMC-BTDCT-MKKG7</td>
</tr>
<tr>
<td>Windows 8.1 Enterprise N</td>
<td>TT4HM-HN7YT-62K67-RGRQJ-JFFXW</td>
</tr>
<tr>
<td>Windows Server 2012 R2 Server Standard</td>
<td>D2N9P-3P6X9-2R39C-7RTCD-MDVJX</td>
</tr>
<tr>
<td>Windows Server 2012 R2 Datacenter</td>
<td>W3GGN-FT8W3-Y4M27-J84CP-Q3VJ9</td>
</tr>
<tr>
<td>Windows Server 2012 R2 Essentials</td>
<td>KNC87-3J2TX-XB4WP-VCPJV-M4FWM</td>
</tr>
</tbody></table>
<h2 id="Windows-Server-2012-和-Windows-8"><a href="#Windows-Server-2012-和-Windows-8" class="headerlink" title="Windows Server 2012 和 Windows 8"></a>Windows Server 2012 和 Windows 8</h2><table>
<thead>
<tr>
<th>操作系统</th>
<th>KMS激活序列号</th>
</tr>
</thead>
<tbody><tr>
<td>Windows 8 Professional</td>
<td>NG4HW-VH26C-733KW-K6F98-J8CK4</td>
</tr>
<tr>
<td>Windows 8 Professional N</td>
<td>XCVCF-2NXM9-723PB-MHCB7-2RYQQ</td>
</tr>
<tr>
<td>Windows 8 Enterprise</td>
<td>32JNW-9KQ84-P47T8-D8GGY-CWCK7</td>
</tr>
<tr>
<td>Windows 8 Enterprise N</td>
<td>JMNMF-RHW7P-DMY6X-RF3DR-X2BQT</td>
</tr>
<tr>
<td>Windows Server 2012</td>
<td>BN3D2-R7TKB-3YPBD-8DRP2-27GG4</td>
</tr>
<tr>
<td>Windows Server 2012 N</td>
<td>8N2M2-HWPGY-7PGT9-HGDD8-GVGGY</td>
</tr>
<tr>
<td>Windows Server 2012 Single Language</td>
<td>2WN2H-YGCQR-KFX6K-CD6TF-84YXQ</td>
</tr>
<tr>
<td>Windows Server 2012 Country Specific</td>
<td>4K36P-JN4VD-GDC6V-KDT89-DYFKP</td>
</tr>
<tr>
<td>Windows Server 2012 Server Standard</td>
<td>XC9B7-NBPP2-83J2H-RHMBY-92BT4</td>
</tr>
<tr>
<td>Windows Server 2012 MultiPoint Standard</td>
<td>HM7DN-YVMH3-46JC3-XYTG7-CYQJJ</td>
</tr>
<tr>
<td>Windows Server 2012 MultiPoint Premium</td>
<td>XNH6W-2V9GX-RGJ4K-Y8X6F-QGJ2G</td>
</tr>
<tr>
<td>Windows Server 2012 Datacenter</td>
<td>48HP8-DN98B-MYWDG-T2DCC-8W83P</td>
</tr>
</tbody></table>
<h2 id="Windows-7-and-Windows-Server-2008-R2"><a href="#Windows-7-and-Windows-Server-2008-R2" class="headerlink" title="Windows 7 and Windows Server 2008 R2"></a>Windows 7 and Windows Server 2008 R2</h2><table>
<thead>
<tr>
<th>操作系统</th>
<th>KMS激活序列号</th>
</tr>
</thead>
<tbody><tr>
<td>Windows 7 Professional</td>
<td>FJ82H-XT6CR-J8D7P-XQJJ2-GPDD4</td>
</tr>
<tr>
<td>Windows 7 Professional N</td>
<td>MRPKT-YTG23-K7D7T-X2JMM-QY7MG</td>
</tr>
<tr>
<td>Windows 7 Professional E</td>
<td>W82YF-2Q76Y-63HXB-FGJG9-GF7QX</td>
</tr>
<tr>
<td>Windows 7 Enterprise</td>
<td>33PXH-7Y6KF-2VJC9-XBBR8-HVTHH</td>
</tr>
<tr>
<td>Windows 7 Enterprise N</td>
<td>YDRBP-3D83W-TY26F-D46B2-XCKRJ</td>
</tr>
<tr>
<td>Windows 7 Enterprise E</td>
<td>C29WB-22CC8-VJ326-GHFJW-H9DH4</td>
</tr>
<tr>
<td>Windows Server 2008 R2 Web</td>
<td>6TPJF-RBVHG-WBW2R-86QPH-6RTM4</td>
</tr>
<tr>
<td>Windows Server 2008 R2 HPC edition</td>
<td>TT8MH-CG224-D3D7Q-498W2-9QCTX</td>
</tr>
<tr>
<td>Windows Server 2008 R2 Standard</td>
<td>YC6KT-GKW9T-YTKYR-T4X34-R7VHC</td>
</tr>
<tr>
<td>Windows Server 2008 R2 Enterprise</td>
<td>489J6-VHDMP-X63PK-3K798-CPX3Y</td>
</tr>
<tr>
<td>Windows Server 2008 R2 Datacenter</td>
<td>74YFP-3QFB3-KQT8W-PMXWJ-7M648</td>
</tr>
<tr>
<td>Windows Server 2008 R2 for Itanium-based Systems</td>
<td>GT63C-RJFQ3-4GMB6-BRFB9-CB83V</td>
</tr>
</tbody></table>
<h2 id="Windows-Vista-and-Windows-Server-2008"><a href="#Windows-Vista-and-Windows-Server-2008" class="headerlink" title="Windows Vista and Windows Server 2008"></a>Windows Vista and Windows Server 2008</h2><table>
<thead>
<tr>
<th>操作系统</th>
<th>KMS激活序列号</th>
</tr>
</thead>
<tbody><tr>
<td>Windows Vista Business</td>
<td>YFKBB-PQJJV-G996G-VWGXY-2V3X8</td>
</tr>
<tr>
<td>Windows Vista Business N</td>
<td>HMBQG-8H2RH-C77VX-27R82-VMQBT</td>
</tr>
<tr>
<td>Windows Vista Enterprise</td>
<td>VKK3X-68KWM-X2YGT-QR4M6-4BWMV</td>
</tr>
<tr>
<td>Windows Vista Enterprise N</td>
<td>VTC42-BM838-43QHV-84HX6-XJXKV</td>
</tr>
<tr>
<td>Windows Web Server 2008</td>
<td>WYR28-R7TFJ-3X2YQ-YCY4H-M249D</td>
</tr>
<tr>
<td>Windows Server 2008 Standard</td>
<td>TM24T-X9RMF-VWXK6-X8JC9-BFGM2</td>
</tr>
<tr>
<td>Windows Server 2008 Standard without Hyper-V</td>
<td>W7VD6-7JFBR-RX26B-YKQ3Y-6FFFJ</td>
</tr>
<tr>
<td>Windows Server 2008 Enterprise</td>
<td>YQGMW-MPWTJ-34KDK-48M3W-X4Q6V</td>
</tr>
<tr>
<td>Windows Server 2008 Enterprise without Hyper-V</td>
<td>39BXF-X8Q23-P2WWT-38T2F-G3FPG</td>
</tr>
<tr>
<td>Windows Server 2008 HPC</td>
<td>RCTX3-KWVHP-BR6TB-RB6DM-6X7HP</td>
</tr>
<tr>
<td>Windows Server 2008 Datacenter</td>
<td>7M67G-PC374-GR742-YH8V4-TCBY3</td>
</tr>
<tr>
<td>Windows Server 2008 Datacenter without Hyper-V</td>
<td>22XQ2-VRXRG-P8D42-K34TD-G3QQC</td>
</tr>
<tr>
<td>Windows Server 2008 for Itanium-Based Systems</td>
<td>4DWFP-JF3DJ-B7DTH-78FJB-PDRHK</td>
</tr>
</tbody></table>
]]></content>
  </entry>
  <entry>
    <title>Modbus及modbusTCP</title>
    <url>/2022/06/02/modbus/</url>
    <content><![CDATA[<h1 id="（一）Modbus通讯协议简介"><a href="#（一）Modbus通讯协议简介" class="headerlink" title="（一）Modbus通讯协议简介"></a>（一）Modbus通讯协议简介</h1><h3 id="一、简介"><a href="#一、简介" class="headerlink" title="一、简介"></a><strong>一、简介</strong></h3><p> 　Modbus是一种串行通信协议，是Modicon公司于1979年为使用可编程逻辑控制器PLC通信而发表。Modbus是工业领域通信协议的业界标准，是工业电子设备之间常用的连接方式。Modbus在工业控制领域通信协议中被广泛使用基于以下几个特点：</p>
<ol>
<li>公开发表并且无版权要求；</li>
<li>易于部署和维护；</li>
<li>对供应商来说，修改移动本地的比特或字节没有很多限制。</li>
</ol>
<h3 id="二、Modbus通讯方式"><a href="#二、Modbus通讯方式" class="headerlink" title="二、Modbus通讯方式"></a>二、Modbus通讯方式</h3><ol>
<li>以太网上的 TCP/IP ；</li>
<li>各种媒体（有线：EIA/TIA-232-E、EIA-422、EIA/TIA-485-A ；光纤、无线等）上的异步串行传输；Modbus RTU和Modbus ASCII通讯既是采用该方式；</li>
<li>Modbus Plus，一种高速令牌传递网络。</li>
</ol>
<p><img src="./1789291-20200530140559414-931108713.jpg" alt="img"></p>
<h3 id="三、协议描述"><a href="#三、协议描述" class="headerlink" title="三、协议描述"></a>三、协议描述</h3><p>　　Modbus协议定义了一个控制器能认识使用的消息结构,而不管它们是经过何种网络进行通信的。它描述了一控制器请求访问其它设备的过程，如果回应来自其它设备的请求，以及怎样侦测错误并记录。它制定了消息域格局和内容的公共格式。 　</p>
<p>　　通过此协议，控制器相互之间、或控制器经由网络（如以太网）可以和其它设备之间进行通信。Modbus协议使用的是主从通讯技术，即由主设备主动查询和操作从设备。一般将主控设备方所使用的协议称为Modbus Master，从设备方使用的协议称为Modbus Slave。典型的主设备包括工控机和工业控制器等；典型的从设备如PLC可编程控制器等。Modbus通讯物理接口可以选用串口（包括RS232、RS485和RS422），也可以选择以太网口。其通信遵循以下的过程：</p>
<ol>
<li>主设备（客户机）向从设备（服务器）发送请求；</li>
<li>从设备（服务器）分析并处理主设备（客户机）的请求，然后向主设备（客户机）发送结果；</li>
<li>如果出现任何差错，从设备（服务器）将返回一个异常功能码 。</li>
</ol>
<p><img src="./1789291-20200530144651500-608118892.jpg" alt="img"></p>
<p><img src="./1789291-20200530144719721-773949887.jpg" alt="img"></p>
<p>　　当在一Modbus网络上通信时，此协议决定了每个控制器须要知道它们的设备地址，识别按地址发来的消息，决定要产生何种行动。如果需要回应，控制器将生成反馈信息并用Modbus协议发出。在其它网络上，包含了Modbus协议的消息转换为在此网络上使用的帧或包结构。这种转换也扩展了根据具体的网络解决节地址、路由路径及错误检测的方法。</p>
<p>　　Modbus的工作方式是请求/应答，每次通讯都是主站先发送指令，可以是广播，或是向特定从站单播，从站响应指令，并按要求应答，或者报告异常；当主站不发送请求时，从站不会自己发出数据，从站和从站之间不能直接通讯。</p>
<p>　　Modbus协议能够应用在不同类型的总线或者网络。对应不同的总线或网络，Modbus协议引入一些附加域映射成应用数据单元（ADU），即ADU = 附加域 + PDU。例如：</p>
<ul>
<li>RS232 / RS485 ADU = 253 字节+服务器地址(1 byte) + CRC (2 字节) = 256 字节 ；</li>
<li>TCP MODBUS ADU = 249 字节+ MBAP (7 字节) = 256 字节 。</li>
</ul>
<p><img src="./1789291-20200530143538234-1678145168.jpg" alt="img"></p>
<h3 id="四、数据编码"><a href="#四、数据编码" class="headerlink" title="四、数据编码"></a>四、数据编码</h3><p>　　MODBUS 使用一个‘big-Endian’ 表示地址和数据项。这意味着当发射多个字节时，首先发送最高有效位。 例如：</p>
<table>
<thead>
<tr>
<th>Register size : 16 - bits</th>
<th>value: 0x1234</th>
<th>the first byte sent is :0x12</th>
<th>then:0x34</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="五、数据模型"><a href="#五、数据模型" class="headerlink" title="五、数据模型"></a>五、数据模型</h3><p>　　MODBUS 以一系列具有不同特征表格上的数据模型为基础。四个基本表格为：</p>
<p><img src="./1789291-20200530153841235-1800376423.jpg" alt="img"></p>
<h3 id="六、功能码"><a href="#六、功能码" class="headerlink" title="六、功能码"></a>六、功能码</h3><p>　　有三类Modbus功能码。分别是：</p>
<p>　　<strong>1.公共功能码：</strong></p>
<ul>
<li>是较好地被定义的功能码 ；</li>
<li>保证是唯一的；</li>
<li>MODBUS 组织可改变的 ；</li>
<li>公开证明的 ；</li>
<li>具有可用的一致性测试 ；</li>
<li>MB IETF RFC 中证明的 ；</li>
<li>包含已被定义的公共指配功能码和未来使用的未指配保留供功能码 。</li>
</ul>
<p>　　<strong>2.用户定义功能码：</strong></p>
<ul>
<li>有两个用户定义功能码的定义范围，即 65 至 72 和十进制 100 至 110 ；</li>
<li>用户没有 MODBUS 组织的任何批准就可以选择和实现一个功能码 ；</li>
<li>不能保证被选功能码的使用是唯一的 ；</li>
<li>如果用户要重新设置功能作为一个公共功能码，那么用户必须启动 RFC，以便将改变引入公共分类中，并且指配一个新的公共功能码 。</li>
</ul>
<p>　　<strong>3.保留功能码：</strong></p>
<ul>
<li>一些公司对传统产品通常使用的功能码，并且对公共使用是无效的功能码 。</li>
</ul>
<p><img src="./1789291-20200530155234175-1895322693.jpg" alt="img"></p>
<p>　　<strong>4.公共功能码定义如下表所示：</strong></p>
<p><strong><img src="./1789291-20200530155637575-1588436382.jpg" alt="img"></strong></p>
<h1 id="（二）Modbus-RTU协议使用说明"><a href="#（二）Modbus-RTU协议使用说明" class="headerlink" title="（二）Modbus RTU协议使用说明"></a>（二）Modbus RTU协议使用说明</h1><h3 id="一、Modbus-RTU数据帧说明"><a href="#一、Modbus-RTU数据帧说明" class="headerlink" title="一、Modbus RTU数据帧说明"></a>一、Modbus RTU数据帧说明</h3><p><img src="./1789291-20200531131537098-1326034318.jpg" alt="img"></p>
<p>　　由发送设备将 Modbus 报文构造为带有已知起始和结束标记的帧。这使设备可以在报文的开始接收新帧，并且知道何时报文结束。不完整的报文必须能够被检测到而错误标志必须作为结果被设置。在 RTU 模式，报文帧由时长至少为 3.5 个字符时间的空闲间隔区分。在后续的部分，这个时间区间被称作 t3.5。</p>
<p><img src="./1789291-20200531131938510-1812325612.jpg" alt="img"></p>
<p>　　整个报文帧必须以连续的字符流发送。如果两个字符之间的空闲间隔大于 1.5 个字符时间，则报文帧被认为不完整应该被接收节点丢弃。 </p>
<p><img src="./1789291-20200531132214410-973250130.jpg" alt="img"></p>
<h3 id="二、MODBUS指令说明"><a href="#二、MODBUS指令说明" class="headerlink" title="二、MODBUS指令说明"></a>二、MODBUS指令说明</h3><p>　　<strong>1、读线圈寄存器01H</strong></p>
<p>　　1) 描述：</p>
<p>　　读MODBUS从机线圈寄存器当前状态。</p>
<p>　　2) 查询：</p>
<p>　　例如从机地址为0x11，线圈寄存器的起始地址为0x0013，结束地址为0x0037。该次查询总共访问(0x0037-0x0013 + 1)37个线圈寄存器。</p>
<table>
<thead>
<tr>
<th></th>
<th>Hex</th>
</tr>
</thead>
<tbody><tr>
<td>从机地址(1个字节)</td>
<td>11</td>
</tr>
<tr>
<td>功能码(1个字节)</td>
<td>01</td>
</tr>
<tr>
<td>寄存器起始地址高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器起始地址低字节(1个字节)</td>
<td>13</td>
</tr>
<tr>
<td>寄存器数量高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器数量低字节(1个字节)</td>
<td>25</td>
</tr>
<tr>
<td>CRC校验高字节(1个字节)</td>
<td>0E</td>
</tr>
<tr>
<td>CRC校验低字节(1个字节)</td>
<td>84</td>
</tr>
</tbody></table>
<p>　　3) 响应</p>
<p>　　响应负载中的各线圈状态与数据内容每位相对应。1代表ON，0代表OFF。若返回的线圈数不为8的倍数，则在最后数据字节未尾使用0代替。</p>
<table>
<thead>
<tr>
<th></th>
<th>Hex</th>
</tr>
</thead>
<tbody><tr>
<td>从机地址(1个字节)</td>
<td>11</td>
</tr>
<tr>
<td>功能码(1个字节)</td>
<td>01</td>
</tr>
<tr>
<td>返回字节数(1个字节)</td>
<td>05</td>
</tr>
<tr>
<td>数据1（线圈0x001A - 线圈0x0013）(1个字节)</td>
<td>CD</td>
</tr>
<tr>
<td>数据2（线圈0x0022 - 线圈0x001B）(1个字节)</td>
<td>6B</td>
</tr>
<tr>
<td>数据3（线圈0x002A - 线圈0x0023）(1个字节)</td>
<td>B2</td>
</tr>
<tr>
<td>数据4（线圈0x0032 - 线圈0x002B）(1个字节)</td>
<td>0E</td>
</tr>
<tr>
<td>数据5（线圈0x0037 - 线圈0x0033）(1个字节)</td>
<td>1B</td>
</tr>
<tr>
<td>CRC校验高字节(1个字节)</td>
<td>45</td>
</tr>
<tr>
<td>CRC校验低字节(1个字节)</td>
<td>E6</td>
</tr>
</tbody></table>
<p>　　线圈0x0013到线圈0x001A的状态为0xCD，二进制值为11001101，该字节的最高字节为线圈0x001A，最低字节为线圈0x0013。线圈0x001A到线圈0x0013的状态分别为ON-ON-OFF-OFF-ON-ON-OFF-ON。</p>
<table>
<thead>
<tr>
<th>0x001A</th>
<th>0x0019</th>
<th>0x0018</th>
<th>0x0017</th>
<th>0x0016</th>
<th>0x0015</th>
<th>0x0014</th>
<th>0x0013</th>
</tr>
</thead>
<tbody><tr>
<td>ON</td>
<td>ON</td>
<td>OFF</td>
<td>OFF</td>
<td>ON</td>
<td>ON</td>
<td>OFF</td>
<td>ON</td>
</tr>
</tbody></table>
<p>　　最后一个数据字节中，线圈0x0033到线圈0x0037状态为0x1B(二进制00011011)，线圈0x0037是左数第4位，线圈0x0033为该字节的最低字节，线圈0x0037至线圈0x0033的状态分别为ON-ON-OFF-ON-ON，剩余3位使用0填充。</p>
<table>
<thead>
<tr>
<th>0x003A</th>
<th>0x0039</th>
<th>0x0038</th>
<th>0x0037</th>
<th>0x0036</th>
<th>0x0035</th>
<th>0x0034</th>
<th>0x0033</th>
</tr>
</thead>
<tbody><tr>
<td>填充</td>
<td>填充</td>
<td>填充</td>
<td>ON</td>
<td>ON</td>
<td>OFF</td>
<td>ON</td>
<td>ON</td>
</tr>
</tbody></table>
<p>　　<strong>2、读离散输入寄存器 02H</strong></p>
<p>　　1) 说明</p>
<p>　　读离散输入寄存器状态。</p>
<p>　　2) 查询</p>
<p>　　从机地址为0x11。离散输入寄存器的起始地址为0x00C4，结束寄存器地址为0x00D9。总共访问(0x00D9-0x00C4+1)22个离散输入寄存器。</p>
<table>
<thead>
<tr>
<th></th>
<th>Hex</th>
</tr>
</thead>
<tbody><tr>
<td>从机地址(1个字节)</td>
<td>11</td>
</tr>
<tr>
<td>功能码(1个字节)</td>
<td>02</td>
</tr>
<tr>
<td>寄存器地址高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器地址低字节(1个字节)</td>
<td>C4</td>
</tr>
<tr>
<td>寄存器数量高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器数量低字节(1个字节)</td>
<td>16</td>
</tr>
<tr>
<td>CRC校验高字节(1个字节)</td>
<td>BA</td>
</tr>
<tr>
<td>CRC校验低字节(1个字节)</td>
<td>A9</td>
</tr>
</tbody></table>
<p>　　3) 响应</p>
<p>　　响应各离散输入寄存器状态，分别对应数据区中的每位值，1 代表ON；0 代表OFF。第一个数据字节的LSB(最低字节)为查询的寻址地址，其他输入口按顺序在该字节中由低字节向高字节排列，直到填充满8位。下一个字节中的8个输入位也是从低字节到高字节排列。若返回的输入位数不是8的倍数，则在最后的数据字节中的剩余位至该字节的最高位使用0填充。</p>
<table>
<thead>
<tr>
<th></th>
<th>Hex</th>
</tr>
</thead>
<tbody><tr>
<td>从机地址(1个字节)</td>
<td>11</td>
</tr>
<tr>
<td>功能码(1个字节)</td>
<td>02</td>
</tr>
<tr>
<td>返回字节数(1个字节)</td>
<td>03</td>
</tr>
<tr>
<td>数据1(0x00CB - 0x00C4)(1个字节)</td>
<td>AC</td>
</tr>
<tr>
<td>数据1(0x00D3 - 0x00CC)(1个字节)</td>
<td>DB</td>
</tr>
<tr>
<td>数据1(0x00D9 - 0x00D4)(1个字节)</td>
<td>35</td>
</tr>
<tr>
<td>CRC校验高字节(1个字节)</td>
<td>20</td>
</tr>
<tr>
<td>CRC校验低字节(1个字节)</td>
<td>18</td>
</tr>
</tbody></table>
<p>　　离散输入寄存器0x00D4到0x00D9的状态为0x35 (二进制00110101)。输入寄存器0x00D9为左数第3位，输入寄存器0x00D4为最低位，输入寄存器0x00D9到0x00D4的状态分别为ON-ON-OFF-ON-OFF-ON。0x00DB寄存器和0x00DA寄存器被0填充。</p>
<table>
<thead>
<tr>
<th>0x00CB</th>
<th>0x00CA</th>
<th>0x00C9</th>
<th>0x00C8</th>
<th>0x00C7</th>
<th>0x00C6</th>
<th>0x00C5</th>
<th>0x00C4</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>0x00D3</td>
<td>0x00D2</td>
<td>0x00D1</td>
<td>0x00D0</td>
<td>0x00CF</td>
<td>0x00CE</td>
<td>0x00CD</td>
<td>0x00CC</td>
</tr>
<tr>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td>0x00DB</td>
<td>0x00DA</td>
<td>0x00D9</td>
<td>0x00D8</td>
<td>0x00D7</td>
<td>0x00D6</td>
<td>0x00D5</td>
<td>0x00D4</td>
</tr>
<tr>
<td>填充</td>
<td>填充</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
</tbody></table>
<p>　　<strong>3、读保持寄存器 03H</strong></p>
<p>　　1) 说明<br>　　读保持寄存器。可读取单个或多个保持寄存器。<br>　　2) 查询<br>　　从机地址为0x11。保持寄存器的起始地址为0x006B，结束地址为0x006D。该次查询总共访问(0x006D-0x006B+1)3个保持寄存器。</p>
<table>
<thead>
<tr>
<th></th>
<th>Hex</th>
</tr>
</thead>
<tbody><tr>
<td>从机地址(1个字节)</td>
<td>11</td>
</tr>
<tr>
<td>功能码(1个字节)</td>
<td>03</td>
</tr>
<tr>
<td>寄存器地址高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器地址低字节(1个字节)</td>
<td>6B</td>
</tr>
<tr>
<td>寄存器数量高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器数量低字节(1个字节)</td>
<td>03</td>
</tr>
<tr>
<td>CRC高字节(1个字节)</td>
<td>76</td>
</tr>
<tr>
<td>CRC低字节(1个字节)</td>
<td>87</td>
</tr>
</tbody></table>
<p>　　3) 响应<br>保持寄存器的长度为2个字节。对于单个保持寄存器而言，寄存器高字节数据先被传输，低字节数据后被传输。保持寄存器之间，低地址寄存器先被传输，高地址寄存器后被传输。</p>
<table>
<thead>
<tr>
<th></th>
<th>Hex</th>
</tr>
</thead>
<tbody><tr>
<td>从机地址(1个字节)</td>
<td>11</td>
</tr>
<tr>
<td>功能码(1个字节)</td>
<td>03</td>
</tr>
<tr>
<td>字节数(1个字节)</td>
<td>06</td>
</tr>
<tr>
<td>数据1高字节(0x006B)(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>数据1低字节(0x006B)(1个字节)</td>
<td>6B</td>
</tr>
<tr>
<td>数据2高字节(0x006C)(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>数据2低字节(0x006C)(1个字节)</td>
<td>13</td>
</tr>
<tr>
<td>数据3高字节(0x006D)(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>数据3低字节(0x006D)(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>CRC高字节(1个字节)</td>
<td>38</td>
</tr>
<tr>
<td>CRC低字节(1个字节)</td>
<td>B9</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>0x006B高字节</th>
<th>0x006B低字节</th>
<th>0x006C高字节</th>
<th>0x006C低字节</th>
<th>0x006D高字节</th>
<th>0x006D低字节</th>
</tr>
</thead>
<tbody><tr>
<td>00</td>
<td>6B</td>
<td>00</td>
<td>13</td>
<td>00</td>
<td>00</td>
</tr>
</tbody></table>
<p>　　<strong>4、读输入寄存器 04H</strong></p>
<p>　　1) 说明<br>　　读输入寄存器命令。该命令支持单个寄存器访问也支持多个寄存器访问。<br>　　2) 查询<br>　　从机地址为0x11。输入寄存器的起始地址为0x0008，寄存器的结束地址为0x0009。本次访问访问2个读入寄存器。</p>
<table>
<thead>
<tr>
<th></th>
<th>Hex</th>
</tr>
</thead>
<tbody><tr>
<td>从机地址(1个字节)</td>
<td>11</td>
</tr>
<tr>
<td>功能码(1个字节)</td>
<td>04</td>
</tr>
<tr>
<td>寄存器起始地址高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器起始地址低字节(1个字节)</td>
<td>08</td>
</tr>
<tr>
<td>寄存器数量高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器数量低字节(1个字节)</td>
<td>02</td>
</tr>
<tr>
<td>CRC高字节(1个字节)</td>
<td>F2</td>
</tr>
<tr>
<td>CRC低字节(1个字节)</td>
<td>99</td>
</tr>
</tbody></table>
<p>　　3) 响应<br>　　输入寄存器长度为2个字节。对于单个输入寄存器而言，寄存器高字节数据先被传输，低字节数据后被传输。输入寄存器之间，低地址寄存器先被传输，高地址寄存器后被传输。</p>
<table>
<thead>
<tr>
<th></th>
<th>Hex</th>
</tr>
</thead>
<tbody><tr>
<td>从机地址(1个字节)</td>
<td>11</td>
</tr>
<tr>
<td>功能码(1个字节)</td>
<td>04</td>
</tr>
<tr>
<td>字节数(1个字节)</td>
<td>04</td>
</tr>
<tr>
<td>数据1高字节(0x0008)(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>数据1低字节(0x0008)(1个字节)</td>
<td>0A</td>
</tr>
<tr>
<td>数据2高字节(0x0009)(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>数据2低字节(0x0009)(1个字节)</td>
<td>0B</td>
</tr>
<tr>
<td>CRC高字节(1个字节)</td>
<td>8B</td>
</tr>
<tr>
<td>CRC低字节(1个字节)</td>
<td>80</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>0x0008高字节</th>
<th>0x0008低字节</th>
<th>0x0009高字节</th>
<th>0x0009低字节</th>
</tr>
</thead>
<tbody><tr>
<td>0x00</td>
<td>0x0A</td>
<td>0x00</td>
<td>0x0B</td>
</tr>
</tbody></table>
<p>　　<strong>5、写单个线圈寄存器 05H</strong></p>
<p>　　1) 说明<br>　　写单个线圈寄存器。0xFF00值请求线圈处于ON状态，0x0000值请求线圈处于OFF状态。0x05指令设置单个线圈的状态，0x15指令可以设置多个线圈的状态，两个指令虽然都设定线圈的ON/OFF状态，但是ON/OFF的表达方式却不同。<br>　　2) 查询<br>　　从机地址为0x11，线圈寄存器的地址为0x00AC。使0x00AC线圈处于ON状态，即数据内容为0xFF00。</p>
<table>
<thead>
<tr>
<th></th>
<th>Hex</th>
</tr>
</thead>
<tbody><tr>
<td>从机地址(1个字节)</td>
<td>11</td>
</tr>
<tr>
<td>功能码(1个字节)</td>
<td>05</td>
</tr>
<tr>
<td>寄存器地址高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器地址低字节(1个字节)</td>
<td>AC</td>
</tr>
<tr>
<td>数据1高字节(1个字节)</td>
<td>FF</td>
</tr>
<tr>
<td>数据1低字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>CRC校验高字节(1个字节)</td>
<td>4E</td>
</tr>
<tr>
<td>CRC校验低字节(1个字节)</td>
<td>8B</td>
</tr>
</tbody></table>
<p>　　3) 响应</p>
<table>
<thead>
<tr>
<th></th>
<th>Hex</th>
</tr>
</thead>
<tbody><tr>
<td>从机地址(1个字节)</td>
<td>11</td>
</tr>
<tr>
<td>功能码(1个字节)</td>
<td>05</td>
</tr>
<tr>
<td>寄存器地址高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器地址低字节(1个字节)</td>
<td>AC</td>
</tr>
<tr>
<td>寄存器1高字节(1个字节)</td>
<td>FF</td>
</tr>
<tr>
<td>寄存器1低字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>CRC校验高字节(1个字节)</td>
<td>4E</td>
</tr>
<tr>
<td>CRC校验低字节(1个字节)</td>
<td>8B</td>
</tr>
</tbody></table>
<p>　　<strong>6、写单个保持寄存器 06H</strong></p>
<p>　　1) 说明<br>　　写保持寄存器。注意0x06指令只能操作单个保持寄存器，0x16指令可以设置单个或多个保持寄存器。<br>　　2) 查询<br>　　从机地址为0x11。保持寄存器地址为0x0001。寄存器内容为0x0003。</p>
<table>
<thead>
<tr>
<th></th>
<th>Hex</th>
</tr>
</thead>
<tbody><tr>
<td>从机地址(1个字节)</td>
<td>11</td>
</tr>
<tr>
<td>功能码(1个字节)</td>
<td>06</td>
</tr>
<tr>
<td>寄存器地址高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器地址低字节(1个字节)</td>
<td>01</td>
</tr>
<tr>
<td>数据1高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>数据1低字节(1个字节)</td>
<td>01</td>
</tr>
<tr>
<td>CRC校验高字节(1个字节)</td>
<td>9A</td>
</tr>
<tr>
<td>CRC校验低字节(1个字节)</td>
<td>9B</td>
</tr>
</tbody></table>
<p>　　3) 响应</p>
<table>
<thead>
<tr>
<th></th>
<th>Hex</th>
</tr>
</thead>
<tbody><tr>
<td>从机地址(1个字节)</td>
<td>11</td>
</tr>
<tr>
<td>功能码(1个字节)</td>
<td>06</td>
</tr>
<tr>
<td>寄存器地址高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器地址低字节(1个字节)</td>
<td>01</td>
</tr>
<tr>
<td>寄存器数量高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器数量低字节(1个字节)</td>
<td>01</td>
</tr>
<tr>
<td>CRC校验高字节(1个字节)</td>
<td>1B</td>
</tr>
<tr>
<td>CRC校验低字节(1个字节)</td>
<td>5A</td>
</tr>
</tbody></table>
<p>　　<strong>7、写多个线圈寄存器 0FH</strong></p>
<p>　　1) 说明<br>　　写多个线圈寄存器。若数据区的某位值为“1”表示被请求的相应线圈状态为ON，若某位值为“0”，则为状态为OFF。<br>　　2) 查询<br>　　从机地址为0x11，线圈寄存器的起始地址为0x0013，线圈寄存器的结束地址为0x001C。总共访问(0x001C-0x0013+1)10个寄存器。寄存器内容如下表所示。</p>
<table>
<thead>
<tr>
<th>0x001A</th>
<th>0x0019</th>
<th>0x0018</th>
<th>0x0017</th>
<th>0x0016</th>
<th>0x0015</th>
<th>0x0014</th>
<th>0x0013</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>0x0022</td>
<td>0x0021</td>
<td>0x0020</td>
<td>0x001F</td>
<td>0x001E</td>
<td>0x001D</td>
<td>0x001C</td>
<td>0x001B</td>
</tr>
<tr>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody></table>
<p>　　传输的第一个字节0xCD对应线圈为0x0013到0x001A，LSB（最低位）对应线圈0x0013，传输第二个字节为 0x01，对应的线圈为0x001B到0x001C，LSB对应线圈0x001C，其余未使用位使用0填充。</p>
<table>
<thead>
<tr>
<th></th>
<th>Hex</th>
</tr>
</thead>
<tbody><tr>
<td>从机地址(1个字节)</td>
<td>11</td>
</tr>
<tr>
<td>功能码(1个字节)</td>
<td>0F</td>
</tr>
<tr>
<td>寄存器地址高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器地址低字节(1个字节)</td>
<td>13</td>
</tr>
<tr>
<td>寄存器数量高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器数量低字节(1个字节)</td>
<td>0A</td>
</tr>
<tr>
<td>字节数(1个字节)</td>
<td>02</td>
</tr>
<tr>
<td>数据1(0x0013 - 0x001A)(1个字节)</td>
<td>CD</td>
</tr>
<tr>
<td>数据2(0x001B - 0x001C)(1个字节)</td>
<td>01</td>
</tr>
<tr>
<td>CRC校验高字节(1个字节)</td>
<td>BF</td>
</tr>
<tr>
<td>CRC校验低字节(1个字节)</td>
<td>0B</td>
</tr>
</tbody></table>
<p>　　3) 响应</p>
<table>
<thead>
<tr>
<th></th>
<th>Hex</th>
</tr>
</thead>
<tbody><tr>
<td>从机地址(1个字节)</td>
<td>11</td>
</tr>
<tr>
<td>功能码(1个字节)</td>
<td>0F</td>
</tr>
<tr>
<td>寄存器地址高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器地址低字节(1个字节)</td>
<td>13</td>
</tr>
<tr>
<td>寄存器数量高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器数量低字节(1个字节)</td>
<td>0A</td>
</tr>
<tr>
<td>字节数(1个字节)</td>
<td>02</td>
</tr>
<tr>
<td>CRC校验高字节(1个字节)</td>
<td>99</td>
</tr>
<tr>
<td>CRC校验低字节(1个字节)</td>
<td>1B</td>
</tr>
</tbody></table>
<p>　　<strong>8、写多个保持寄存器10H</strong></p>
<p>　　1) 说明<br>　　写多个保持寄存器。<br>　　2) 查询<br>　　从机地址为0x11。保持寄存器的起始地址为0x0001，寄存器的结束地址为0x0002。总共访问(0x0002-0x0001+1)2个寄存器。保持寄存器0x0001的内容为0x000A，保持寄存器0x0002的内容为0x0102。</p>
<table>
<thead>
<tr>
<th></th>
<th>Hex</th>
</tr>
</thead>
<tbody><tr>
<td>从机地址(1个字节)</td>
<td>11</td>
</tr>
<tr>
<td>功能码(1个字节)</td>
<td>10</td>
</tr>
<tr>
<td>寄存器起始地址高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器起始地址低字节(1个字节)</td>
<td>01</td>
</tr>
<tr>
<td>寄存器数量高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器数量低字节(1个字节)</td>
<td>02</td>
</tr>
<tr>
<td>字节数(1个字节)</td>
<td>04</td>
</tr>
<tr>
<td>数据1高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>数据1低字节(1个字节)</td>
<td>0A</td>
</tr>
<tr>
<td>数据2高字节(1个字节)</td>
<td>01</td>
</tr>
<tr>
<td>数据2低字节(1个字节)</td>
<td>02</td>
</tr>
<tr>
<td>CRC校验高字节(1个字节)</td>
<td>C6</td>
</tr>
<tr>
<td>CRC校验低字节(1个字节)</td>
<td>F0</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>地址</th>
<th>0x0001高字节</th>
<th>0x0001低字节</th>
<th>0x0002高字节</th>
<th>0x0002低字节</th>
</tr>
</thead>
<tbody><tr>
<td>数值</td>
<td>0x00</td>
<td>0x0A</td>
<td>0x01</td>
<td>0x02</td>
</tr>
</tbody></table>
<p>　　3) 响应</p>
<table>
<thead>
<tr>
<th></th>
<th>Hex</th>
</tr>
</thead>
<tbody><tr>
<td>从机地址(1个字节)</td>
<td>11</td>
</tr>
<tr>
<td>功能码(1个字节)</td>
<td>10</td>
</tr>
<tr>
<td>寄存器起始地址高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器起始地址低字节(1个字节)</td>
<td>01</td>
</tr>
<tr>
<td>寄存器数量高字节(1个字节)</td>
<td>00</td>
</tr>
<tr>
<td>寄存器数量低字节(1个字节)</td>
<td>02</td>
</tr>
<tr>
<td>CRC校验高字节(1个字节)</td>
<td>12</td>
</tr>
<tr>
<td>CRC校验低字节(1个字节)</td>
<td>98</td>
</tr>
</tbody></table>
<h1 id="（三）Modbus-TCP协议使用说明"><a href="#（三）Modbus-TCP协议使用说明" class="headerlink" title="（三）Modbus TCP协议使用说明"></a>（三）Modbus TCP协议使用说明</h1><h3 id="一、Modbus-TCP数据帧"><a href="#一、Modbus-TCP数据帧" class="headerlink" title="一、Modbus TCP数据帧"></a>一、Modbus TCP数据帧</h3><p>　　ModbusTCP的数据帧可分为两部分：<strong>MBAP</strong>+<strong>PDU</strong>。</p>
<p><img src="./1789291-20200530161850302-400055988.jpg" alt="img"></p>
<p>　　在 TCP/IP 上使用一种专用报文头识别 MODBUS 应用数据单元。将这种报文头称为 MBAP 报文头（MODBUS 协议报文头）。这种报文头提供一些与串行链路上使用的 MODBUS RTU 应用数据单元比较的差别 ：</p>
<ol>
<li>用 MBAP 报文头中的单个字节单元标识符取代 MODBUS 串行链路上通常使用的 MODBUS从地址域。这个单元标识符用于设备的通信，这些设备使用单个IP地址支持多个独立Modbus终端单元，例如：网桥、路由器和网关。</li>
<li>用接收者可以验证完成报文的方式设计所有 MODBUS 请求和响应。对于 MODBUS PDU有固定长度的功能码来说，仅功能码就足够了。对于在请求或响应中携带一个可变数据的功能码来说，数据域包括字节数。</li>
<li>当在 TCP 上携带 MODBUS 时，即使将报文分成多个信息包来传输，办事在 MBAP 报文头上携带附加长度信息，以便接收者能识别报文边界。显式和隐式长度规则的存在以及CRC-32 差错校验码的使用（在以太网上）将对请求或响应报文产生极小的未检出干扰。</li>
</ol>
<h3 id="二、MBAP报文头"><a href="#二、MBAP报文头" class="headerlink" title="二、MBAP报文头"></a><strong>二、MBAP报文头</strong></h3><p>　　原文链接：<a href="https://www.cnblogs.com/ioufev/articles/10830028.html">https://www.cnblogs.com/ioufev/articles/10830028.html</a></p>
<p>　　MBAP的长度为7个字节，组成如下：</p>
<p>　　</p>
<table>
<thead>
<tr>
<th align="center">事务处理标识</th>
<th>协议标识</th>
<th>长度</th>
<th>单元标识符</th>
</tr>
</thead>
<tbody><tr>
<td align="center">2字节</td>
<td>2字节</td>
<td>2字节</td>
<td>1字节</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>内容</th>
<th align="center">解释</th>
</tr>
</thead>
<tbody><tr>
<td><strong>事务处理标识</strong></td>
<td align="center">可以理解为报文的序列号，一般每次通信之后就要加1以区别不同的通信数据报文。</td>
</tr>
<tr>
<td><strong>协议标识符</strong></td>
<td align="center">00 00表示ModbusTCP协议。</td>
</tr>
<tr>
<td><strong>长度</strong></td>
<td align="center">表示接下来的数据长度，单位为字节。</td>
</tr>
<tr>
<td><strong>单元标识符</strong></td>
<td align="center">可以理解为设备地址。</td>
</tr>
</tbody></table>
<h3 id="四、帧结构PDU"><a href="#四、帧结构PDU" class="headerlink" title="四、帧结构PDU"></a>四、<strong>帧结构PDU</strong></h3><p>　　PDU由功能码+数据组成。功能码为1字节，数据长度不定，由具体功能决定。</p>
<p>　　<strong>功能码</strong></p>
<p>　　Modbus的操作对象有四种：线圈、离散输入、输入寄存器、保持寄存器。</p>
<table>
<thead>
<tr>
<th>对象</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>线圈</td>
<td>PLC的输出位，开关量，在Modbus中可读可写</td>
</tr>
<tr>
<td>离散量</td>
<td>PLC的输入位，开关量，在Modbus中只读</td>
</tr>
<tr>
<td>输入寄存器</td>
<td>PLC中只能从模拟量输入端改变的寄存器，在Modbus中只读</td>
</tr>
<tr>
<td>保持寄存器</td>
<td>PLC中用于输出模拟量信号的寄存器，在Modbus中可读可写</td>
</tr>
</tbody></table>
<p>　　根据对象的不同，常用的Modbus的功能码有：</p>
<table>
<thead>
<tr>
<th>功能码</th>
<th align="center">含义</th>
</tr>
</thead>
<tbody><tr>
<td>0x01</td>
<td align="center">读线圈</td>
</tr>
<tr>
<td>0x05</td>
<td align="center">写单个线圈</td>
</tr>
<tr>
<td>0x0F</td>
<td align="center">写多个线圈</td>
</tr>
<tr>
<td>0x02</td>
<td align="center">读离散量输入</td>
</tr>
<tr>
<td>0x04</td>
<td align="center">读输入寄存器</td>
</tr>
<tr>
<td>0x03</td>
<td align="center">读保持寄存器</td>
</tr>
<tr>
<td>0x06</td>
<td align="center">写单个保持寄存器</td>
</tr>
<tr>
<td>0x10</td>
<td align="center">写多个保持寄存器</td>
</tr>
</tbody></table>
<p>　　<strong>0x01：读线圈</strong></p>
<p>　　在从站中读1~2000个连续线圈状态，ON=1,OFF=0</p>
<ul>
<li>请求：MBAP 功能码 起始地址H 起始地址L 数量H 数量L（共12字节）</li>
<li>响应：MBAP 功能码 数据长度 数据（一个地址的数据为1位）</li>
<li>如：在从站0x01中，读取开始地址为0x0002的线圈数据，读0x0008位<br>00 01 00 00 00 06 01 01 00 02 00 08</li>
<li>回：数据长度为0x01个字节，数据为0x01，第一个线圈为ON，其余为OFF<br>00 01 00 00 00 04 01 01 01 01</li>
</ul>
<p>　　<strong>0x05：写单个线圈</strong><br>　　将从站中的一个输出写成ON或OFF，0xFF00请求输出为ON,0x000请求输出为OFF</p>
<ul>
<li>请求：MBAP 功能码 输出地址H 输出地址L 输出值H 输出值L（共12字节）</li>
<li>响应：MBAP 功能码 输出地址H 输出地址L 输出值H 输出值L（共12字节）</li>
<li>如：将地址为0x0003的线圈设为ON<br>00 01 00 00 00 06 01 05 00 03 FF 00</li>
<li>回：写入成功<br>00 01 00 00 00 06 01 05 00 03 FF 00</li>
</ul>
<p>　　<strong>0x0F：写多个线圈</strong><br>　　将一个从站中的一个线圈序列的每个线圈都强制为ON或OFF，数据域中置1的位请求相应输出位ON，置0的位请求响应输出为OFF</p>
<ul>
<li>请求：MBAP 功能码 起始地址H 起始地址L 输出数量H 输出数量L 字节长度 输出值H 输出值L</li>
<li>响应：MBAP 功能码 起始地址H 起始地址L 输出数量H 输出数量L</li>
</ul>
<p>　　<strong>0x02：读离散量输入</strong><br>　　从一个从站中读1~2000个连续的离散量输入状态</p>
<ul>
<li>请求：MBAP 功能码 起始地址H 起始地址L 数量H 数量L（共12字节）</li>
<li>响应：MBAP 功能码 数据长度 数据（长度：9+ceil（数量/8））</li>
<li>如：从地址0x0000开始读0x0012个离散量输入<br>00 01 00 00 00 06 01 02 00 00 00 12</li>
<li>回：数据长度为0x03个字节，数据为0x01 04 00，表示第一个离散量输入和第11个离散量输入为ON，其余为OFF<br>00 01 00 00 00 06 01 02 03 01 04 00</li>
</ul>
<p>　　<strong>0x04：读输入寄存器</strong><br>　　从一个远程设备中读1~2000个连续输入寄存器</p>
<ul>
<li>请求：MBAP 功能码 起始地址H 起始地址L 寄存器数量H 寄存器数量L（共12字节）</li>
<li>响应：MBAP 功能码 数据长度 寄存器数据(长度：9+寄存器数量×2)</li>
<li>如：读起始地址为0x0002，数量为0x0005的寄存器数据<br>00 01 00 00 00 06 01 04 00 02 00 05</li>
<li>回：数据长度为0x0A，第一个寄存器的数据为0x0c，其余为0x00<br>00 01 00 00 00 0D 01 04 0A 00 0C 00 00 00 00 00 00 00 00</li>
</ul>
<p>　　<strong>0x03：读保持寄存器</strong><br>　　从远程设备中读保持寄存器连续块的内容</p>
<ul>
<li>请求：MBAP 功能码 起始地址H 起始地址L 寄存器数量H 寄存器数量L（共12字节）</li>
<li>响应：MBAP 功能码 数据长度 寄存器数据(长度：9+寄存器数量×2)</li>
<li>如：起始地址是0x0000，寄存器数量是 0x0003<br>00 01 00 00 00 06 01 03 00 00 00 03</li>
<li>回：数据长度为0x06，第一个寄存器的数据为0x21，其余为0x00<br>00 01 00 00 00 09 01 03 06 00 21 00 00 00 00</li>
</ul>
<p>　　<strong>0x06：写单个保持寄存器</strong><br>　　在一个远程设备中写一个保持寄存器</p>
<ul>
<li>请求：MBAP 功能码 寄存器地址H 寄存器地址L 寄存器值H 寄存器值L（共12字节）</li>
<li>响应：MBAP 功能码 寄存器地址H 寄存器地址L 寄存器值H 寄存器值L（共12字节）</li>
<li>如：向地址是0x0000的寄存器写入数据0x000A<br>00 01 00 00 00 06 01 06 00 00 00 0A</li>
<li>回：写入成功<br>00 01 00 00 00 06 01 06 00 00 00 0A</li>
</ul>
<p>　　<strong>0x10：写多个保持寄存器</strong><br>　　在一个远程设备中写连续寄存器块（1~123个寄存器）</p>
<ul>
<li>请求：MBAP 功能码 起始地址H 起始地址L 寄存器数量H 寄存器数量L 字节长度 寄存器值（13+寄存器数量×2）</li>
<li>响应：MBAP 功能码 起始地址H 起始地址L 寄存器数量H 寄存器数量L（共12字节）</li>
<li>如：向起始地址为0x0000，数量为0x0001的寄存器写入数据，数据长度为0x02，数据为0x000F<br>00 01 00 00 00 09 01 10 00 00 00 01 02 00 0</li>
<li>回：写入成功<br>00 01 00 00 00 06 01 10 00 00 00 01</li>
</ul>
<h3 id="五、Modbus-TCP示例报文"><a href="#五、Modbus-TCP示例报文" class="headerlink" title="五、Modbus TCP示例报文"></a>五、Modbus TCP示例报文</h3><p>　　ModBusTcp与串行链路Modbus的数据域是一致的，具体数据域可以参考串行Modbus。这里给出几个ModbusTcp的链路解析说明，辅助新人分析报文。</p>
<p>　　原文链接：<a href="https://blog.csdn.net/mikasoi/article/details/81782159">https://blog.csdn.net/mikasoi/article/details/81782159</a></p>
<p>　　1、数据请求</p>
<table>
<thead>
<tr>
<th>97 76 00 00 00 06 04 04 00 7D 00 7D</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>示例</td>
<td>长度</td>
<td>说明</td>
<td>备注</td>
</tr>
<tr>
<td>Map报文头</td>
<td>0x97</td>
<td>1</td>
<td>事务处理标识符Hi</td>
<td>客户机发起，服务器复制，用于事务处理配对</td>
</tr>
<tr>
<td>0x96</td>
<td>1</td>
<td>事务处理标识符Lo</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x0000</td>
<td>2</td>
<td>协议标识符号</td>
<td>客户机发起，服务器复制Modbus协议 = 0.</td>
<td></td>
</tr>
<tr>
<td>0x0006</td>
<td>2</td>
<td>长度</td>
<td>从本字节下一个到最后</td>
<td></td>
</tr>
<tr>
<td>0x04</td>
<td>1</td>
<td>单元标识符</td>
<td>客户机发起，服务器复制串口链路或其他总线上远程终端标识</td>
<td></td>
</tr>
<tr>
<td>功能码</td>
<td>0x04</td>
<td>1</td>
<td>功能码，读寄存器</td>
<td>参考标准modbus协议</td>
</tr>
<tr>
<td>数据</td>
<td>0x007D</td>
<td>2</td>
<td>起始地址</td>
<td></td>
</tr>
<tr>
<td>0x 007D</td>
<td>2</td>
<td>寄存器数量</td>
<td></td>
<td></td>
</tr>
<tr>
<td>校验</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>　　2、数据请求回复</p>
<table>
<thead>
<tr>
<th>97 76 00 00 00 FD 04 04 FA AB 9E 41 18 7A E1 3F 94 7A E1 3F 94 0A 3D 3F 97 51 EC 3F 98 CC CD C0 6C 33 33 C0 E3 CC CD C0 EC EB 85 41 F1 D7 0A 41 E9 47 AE 41 ED EB 85 41 F1 19 9A 43 D0 E6 66 43 C9 4C CD 43 CF EB 85 41 F3 66 66 42 0F CC CD 41 C2 E6 66 44 0A 1E B8 41 FB A3 D7 42 0C CC CD 41 BC C0 00 44 0A B8 52 41 F6 5C 29 42 0F 47 AE 41 D1 C6 66 44 0A 00 00 00 00 C9 9E FF 7F C9 9E FF 7F C9 9E FF 7F C9 9E FF 7F C9 9E FF 7F C9 9E FF 7F C9 9E FF 7F C9 9E FF 7F C9 9E FF 7F 05 16 00 00 04 11 00 00 05 16 00 00 04 11 00 00 05 16 00 00 04 11 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0A 00 0A 00 0A 00 0A 00 04 00 04 00 04 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0F</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>示例</td>
<td>长度</td>
<td>说明</td>
<td>备注</td>
</tr>
<tr>
<td>Map报文头</td>
<td>0x97</td>
<td>1</td>
<td>事务处理标识符Hi</td>
<td>客户机发起，服务器复制，用于事务处理配对</td>
</tr>
<tr>
<td>0x96</td>
<td>1</td>
<td>事务处理标识符Lo</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x0000</td>
<td>2</td>
<td>协议标识符号</td>
<td>客户机发起，服务器复制Modbus协议 = 0.</td>
<td></td>
</tr>
<tr>
<td>0x00FD</td>
<td>2</td>
<td>长度</td>
<td>从本字节下一个到最后</td>
<td></td>
</tr>
<tr>
<td>0x04</td>
<td>1</td>
<td>单元标识符</td>
<td>客户机发起，服务器复制串口链路或其他总线上远程终端标识</td>
<td></td>
</tr>
<tr>
<td>功能码</td>
<td>0x04</td>
<td>1</td>
<td>功能码，读寄存器</td>
<td>参考标准modbus协议</td>
</tr>
<tr>
<td>数据</td>
<td>0x FA</td>
<td>1</td>
<td>字节个数</td>
<td></td>
</tr>
<tr>
<td>0x—-</td>
<td></td>
<td>数据</td>
<td></td>
<td></td>
</tr>
<tr>
<td>校验</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>　　3、写多个寄存器</p>
<p>　　</p>
<table>
<thead>
<tr>
<th>97 79 00 00 00 09 04 10 00 00 00 01 02 00 01</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>示例</td>
<td>长度</td>
<td>说明</td>
<td>备注</td>
</tr>
<tr>
<td>Map报文头</td>
<td>0x97</td>
<td>1</td>
<td>事务处理标识符Hi</td>
<td>客户机发起，服务器复制，用于事务处理配对</td>
</tr>
<tr>
<td>0x79</td>
<td>1</td>
<td>事务处理标识符Lo</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x0000</td>
<td>2</td>
<td>协议标识符号</td>
<td>客户机发起，服务器复制Modbus协议 = 0.</td>
<td></td>
</tr>
<tr>
<td>0x0009</td>
<td>2</td>
<td>长度</td>
<td>从本字节下一个到最后</td>
<td></td>
</tr>
<tr>
<td>0x04</td>
<td>1</td>
<td>单元标识符</td>
<td>客户机发起，服务器复制串口链路或其他总线上远程终端标识</td>
<td></td>
</tr>
<tr>
<td>功能码</td>
<td>0x10</td>
<td>1</td>
<td>功能码，读寄存器</td>
<td>参考标准modbus协议</td>
</tr>
<tr>
<td>数据</td>
<td>0x0000</td>
<td>2</td>
<td>起始地址</td>
<td></td>
</tr>
<tr>
<td>0x 0001</td>
<td>2</td>
<td>写寄存器数量</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x 02</td>
<td>1</td>
<td>写字节的个数</td>
<td></td>
<td></td>
</tr>
<tr>
<td>00 01</td>
<td>2</td>
<td>目标值</td>
<td></td>
<td></td>
</tr>
<tr>
<td>校验</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>　　</p>
<p>　　4、写多个寄存器响应</p>
<p>　　</p>
<table>
<thead>
<tr>
<th>97 79 00 00 00 06 04 10 00 00 00 01</th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>示例</td>
<td>长度</td>
<td>说明</td>
<td>备注</td>
</tr>
<tr>
<td>Map报文头</td>
<td>0x97</td>
<td>1</td>
<td>事务处理标识符Hi</td>
<td>客户机发起，服务器复制，用于事务处理配对</td>
</tr>
<tr>
<td>0x79</td>
<td>1</td>
<td>事务处理标识符Lo</td>
<td></td>
<td></td>
</tr>
<tr>
<td>0x0000</td>
<td>2</td>
<td>协议标识符号</td>
<td>客户机发起，服务器复制Modbus协议 = 0.</td>
<td></td>
</tr>
<tr>
<td>0x0006</td>
<td>2</td>
<td>长度</td>
<td>从本字节下一个到最后</td>
<td></td>
</tr>
<tr>
<td>0x04</td>
<td>1</td>
<td>单元标识符</td>
<td>客户机发起，服务器复制串口链路或其他总线上远程终端标识</td>
<td></td>
</tr>
<tr>
<td>功能码</td>
<td>0x10</td>
<td>1</td>
<td>功能码，读寄存器</td>
<td>参考标准modbus协议</td>
</tr>
<tr>
<td>数据</td>
<td>0x0000</td>
<td>2</td>
<td>起始地址</td>
<td></td>
</tr>
<tr>
<td>0x 0001</td>
<td>2</td>
<td>寄存器个数</td>
<td></td>
<td></td>
</tr>
<tr>
<td>校验</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<hr>
<h2 id="ModbusTCP协议分析"><a href="#ModbusTCP协议分析" class="headerlink" title="ModbusTCP协议分析"></a><strong>ModbusTCP协议分析</strong></h2><p>ModbusTCP与ModbusUDP的报文格式是一样的，它们之间的区别其实就是TCP与UDP的区别，因此下面就针对ModbusTCP的协议进行分析，ModbusTCP与ModbusRtu（ModbusASCII）之间的区别如下图：</p>
<p><img src="./v2-e243428dc401a9fef46cf511f1fe6963_1440w.jpg" alt="img"></p>
<p>从上图可以看出，ModbusTCP在Modbus串行通信的基础上，去除了校验（由于TCP本身就带有校验和）和设备地址（ModbusTCP弱化了设备地址，用IP地址来取代），再加上MBAP报文头（占7 bytes），下面针对MBAP进行分析说明：</p>
<table>
<thead>
<tr>
<th>域</th>
<th>长度</th>
<th>说明</th>
<th>客户机</th>
<th>服务器</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>下面针对具体报文进行分析，Modbus协议在串行链路上的报文格式如下所示：</p>
<table>
<thead>
<tr>
<th>事务处理标识符</th>
<th>协议标识符</th>
<th>长度</th>
<th>单元标识符</th>
<th>功能码</th>
<th>数据</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>有了以上理论基础之后，下面针对各个功能码进行详细分析：</p>
<h2 id="读取输出线圈"><a href="#读取输出线圈" class="headerlink" title="读取输出线圈"></a><strong>读取输出线圈</strong></h2><p>发送报文格式如下：</p>
<p><img src="./v2-4a0c542e01c74695e72346ed51bb0682_1440w.jpg" alt="img"></p>
<p>发送报文含义：读取服务器1号从站输出线圈，起始地址为0x13=19，对应地址为00020，线圈数量为0x1B=27，即读取1号从站输出线圈，地址从00020-00046，共27个线圈的状态值。</p>
<blockquote>
<p>这里值得注意一下，协议中的起始地址指的是索引，后面的地址指的是具体地址，对于任意一个存储区，索引都是从0开始的，但是对应的具体地址，与存储区是相关的，比如输出线圈，0对应00001；输入线圈，0对应10001；输入寄存器，0对应30001；保持寄存器，0对应40001。</p>
</blockquote>
<p>返回报文格式如下：</p>
<p><img src="./v2-413d4901d9ab690eb36a72b14a9c9d12_1440w.jpg" alt="img"></p>
<p>返回报文含义：返回服务器1号从站输出线圈00020-00046，共27个线圈的状态值，返回字节数为4个，分别为CD 6B B2 05。</p>
<p>CD=1100 1101 对应 00020-00027</p>
<p>6B=0110 1011 对应 00028-00035</p>
<p>B2=1011 0010 对应 00036-00043</p>
<p>05=0000 0101 对应 00044-00046</p>
<h2 id="读取输入线圈"><a href="#读取输入线圈" class="headerlink" title="读取输入线圈"></a><strong>读取输入线圈</strong></h2><p>发送报文格式如下：</p>
<p><img src="./v2-309004ff48e204e88297edcc71ff7922_1440w.jpg" alt="img"></p>
<p>发送报文含义：读取服务器1号从站输入线圈，起始地址为0xC4=196，对应地址为10197，线圈数量为0x1D=29，即读取1号从站输入线圈，地址从10197-10225，共29个线圈的状态值。</p>
<p>返回报文格式如下：</p>
<p><img src="./v2-6127365ecfac7a2f87f1c51d4781fd99_1440w.jpg" alt="img"></p>
<p>返回报文含义：返回服务器1号从站输入线圈10197-10225，共29个线圈的状态值，返回字节数为4个，分别为CD 6B B2 05。</p>
<p>CD=1100 1101 对应 10197-10204</p>
<p>6B=0110 1011 对应 10205-10212</p>
<p>B2=1011 0010 对应 10213-10220</p>
<p>05=0000 0101 对应 10221-10225</p>
<h2 id="读取保持寄存器"><a href="#读取保持寄存器" class="headerlink" title="读取保持寄存器"></a><strong>读取保持寄存器</strong></h2><p>发送报文格式如下：</p>
<p><img src="./v2-743b528700bd3f66578de0b908e7b3a2_1440w.jpg" alt="img"></p>
<p>发送报文含义：读取服务器1号从站保持寄存器，起始地址为0x6B=107，对应地址为40108，寄存器数量为0x02=2，即读取1号从站保持寄存器，地址从40108-40109，共2个寄存器的数值。</p>
<p>返回报文格式如下：</p>
<p><img src="./v2-f6fef4203d7b41de02f85588ce942e9e_1440w.jpg" alt="img"></p>
<p>返回报文含义：返回服务器1号从站保持寄存器40108-40109，共2个寄存器的数值，返回字节数为4个，分别为02 2B 01 06，40108对应数值为0x022B，40109对应数值为0x0106。</p>
<h2 id="读取输入寄存器"><a href="#读取输入寄存器" class="headerlink" title="读取输入寄存器"></a><strong>读取输入寄存器</strong></h2><p>发送报文格式如下：</p>
<p><img src="./v2-6f7e281afc5b92448e0afbef49096ec4_1440w.jpg" alt="img"></p>
<p>发送报文含义：读取服务器1号从站输入寄存器，起始地址为0x6B=107，对应地址为30108，寄存器数量为0x02=2，即读取1号从站保持寄存器，地址从30108-30109，共2个寄存器的数值。</p>
<p>返回报文格式如下：</p>
<p><img src="./v2-fcf0fe97e3cf1c8a8066283316f81ef7_1440w.jpg" alt="img"></p>
<p>返回报文含义：返回服务器1号从站输入寄存器30108-30109，共2个寄存器的数值，返回字节数为4个，分别为02 2B 01 06，30108对应数值为0x022B，30109对应数值为0x0106。</p>
<h2 id="预置单输出线圈"><a href="#预置单输出线圈" class="headerlink" title="预置单输出线圈"></a><strong>预置单输出线圈</strong></h2><p>发送报文格式如下：</p>
<p><img src="./v2-bde7c0950a527b894e533bba0cdc2909_1440w.jpg" alt="img"></p>
<p>发送报文含义：预置服务器1号从站单个线圈的值，线圈地址为0x00AC=172，对应地址为00173，断通标志0xFF00表示置位，0x000表示复位，即置位1号从站输出线圈00173。</p>
<p>返回报文格式如下：</p>
<p><img src="./v2-bde7c0950a527b894e533bba0cdc2909_1440w.jpg" alt="img"></p>
<p>返回报文含义：预置单输出线圈原报文返回。</p>
<h2 id="预置单寄存器"><a href="#预置单寄存器" class="headerlink" title="预置单寄存器"></a><strong>预置单寄存器</strong></h2><p>发送报文格式如下：</p>
<p><img src="./v2-e1149ccc82d53cbacc0048f5641eb047_1440w.jpg" alt="img"></p>
<p>发送报文含义：预置服务器1号从站单个保持寄存器的值，寄存器地址为0x0087=135，对应地址为40136，写入值为0x039E，即预置1号从站保持寄存器40136值为0x039E。</p>
<p>返回报文格式如下：</p>
<p><img src="./v2-e1149ccc82d53cbacc0048f5641eb047_1440w.jpg" alt="img"></p>
<p>返回报文含义：预置单保持寄存器原报文返回。</p>
<h2 id="预置多线圈"><a href="#预置多线圈" class="headerlink" title="预置多线圈"></a><strong>预置多线圈</strong></h2><p>发送报文格式如下：</p>
<p><img src="./v2-74822b922127ace1c1f09edf9d4b2c6f_1440w.jpg" alt="img"></p>
<p>发送报文含义：预置服务器1号从站多个线圈的值，线圈地址为0x0013=19，对应地址为00020，线圈数为0x0A=10，写入值为0xCD00，即预置1号从站线圈00020-00027=0xCD=1100 1101，00028-00029=0x00=0000 0000。</p>
<p>返回报文格式如下：</p>
<p><img src="./v2-77d0bad3d022d585d9d89e62cece193c_1440w.jpg" alt="img"></p>
<p>返回报文含义：预置多输出线圈返回报文是在原报文基础上除去字节数及具体字节后返回。</p>
<h2 id="预置多寄存器"><a href="#预置多寄存器" class="headerlink" title="预置多寄存器"></a><strong>预置多寄存器</strong></h2><p>发送报文格式如下：</p>
<p><img src="./v2-c4af46360d0ddfaaaefc6eac9c85a879_1440w.jpg" alt="img"></p>
<p>发送报文含义：预置服务器1号从站多个寄存器的值，寄存器地址为0x0087=135，起始地址为40136，寄存器数量为0x02=2，结束地址为40137，写入值为0xCD00和0x0A10，即预置1号从站寄存器40136=0x0105，40137=0x0A10。</p>
<p>返回报文格式如下：</p>
<p><img src="./v2-a3f06cc4569b060b1e0864d9e4fd809c_1440w.jpg" alt="img"></p>
<p>返回报文含义：预置多保持寄存器返回报文是在原报文基础上除去字节数及具体字节后返回。</p>
]]></content>
      <categories>
        <category>通用协议</category>
      </categories>
      <tags>
        <tag>Modbus</tag>
        <tag>ModbusRTU</tag>
        <tag>ModbusTCP</tag>
      </tags>
  </entry>
  <entry>
    <title>将nodered里的电量数据存储到influxdb,方便在grafana展示</title>
    <url>/2022/05/29/nodered-influxdb/</url>
    <content><![CDATA[<h1 id="将nodered里的电量数据存储到influxdb-方便在grafana展示"><a href="#将nodered里的电量数据存储到influxdb-方便在grafana展示" class="headerlink" title="将nodered里的电量数据存储到influxdb,方便在grafana展示"></a>将nodered里的电量数据存储到influxdb,方便在grafana展示</h1><p>首先在你的nodered里安装node-red-contrib-influxdb节点:</p>
<p><img src="./image-20220529223344883.png" alt="image-20220529223344883"></p>
<p>然后导入以下流程:</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;tab&quot;</span><span class="punctuation">,</span><span class="attr">&quot;label&quot;</span><span class="punctuation">:</span><span class="string">&quot;influxdb_DEMO&quot;</span><span class="punctuation">,</span><span class="attr">&quot;disabled&quot;</span><span class="punctuation">:</span><span class="keyword">false</span><span class="punctuation">,</span><span class="attr">&quot;info&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;env&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;9c64fad3bf02f85f&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;debug&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;active&quot;</span><span class="punctuation">:</span><span class="keyword">true</span><span class="punctuation">,</span><span class="attr">&quot;tosidebar&quot;</span><span class="punctuation">:</span><span class="keyword">true</span><span class="punctuation">,</span><span class="attr">&quot;console&quot;</span><span class="punctuation">:</span><span class="keyword">false</span><span class="punctuation">,</span><span class="attr">&quot;tostatus&quot;</span><span class="punctuation">:</span><span class="keyword">false</span><span class="punctuation">,</span><span class="attr">&quot;complete&quot;</span><span class="punctuation">:</span><span class="string">&quot;payload&quot;</span><span class="punctuation">,</span><span class="attr">&quot;targetType&quot;</span><span class="punctuation">:</span><span class="string">&quot;msg&quot;</span><span class="punctuation">,</span><span class="attr">&quot;statusVal&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;statusType&quot;</span><span class="punctuation">:</span><span class="string">&quot;auto&quot;</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">770</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">100</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;23b56d4e8c55a864&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;influxdb in&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;influxdb&quot;</span><span class="punctuation">:</span><span class="string">&quot;ed5228586bb6bef2&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;query&quot;</span><span class="punctuation">:</span><span class="string">&quot;SELECT * FROM test&quot;</span><span class="punctuation">,</span><span class="attr">&quot;rawOutput&quot;</span><span class="punctuation">:</span><span class="keyword">false</span><span class="punctuation">,</span><span class="attr">&quot;precision&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;retentionPolicy&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;org&quot;</span><span class="punctuation">:</span><span class="string">&quot;my-org&quot;</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">460</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">100</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="string">&quot;9c64fad3bf02f85f&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;056c109e535c2d7f&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;inject&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;props&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;p&quot;</span><span class="punctuation">:</span><span class="string">&quot;payload&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;p&quot;</span><span class="punctuation">:</span><span class="string">&quot;topic&quot;</span><span class="punctuation">,</span><span class="attr">&quot;vt&quot;</span><span class="punctuation">:</span><span class="string">&quot;str&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;repeat&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;crontab&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;once&quot;</span><span class="punctuation">:</span><span class="keyword">false</span><span class="punctuation">,</span><span class="attr">&quot;onceDelay&quot;</span><span class="punctuation">:</span><span class="number">0.1</span><span class="punctuation">,</span><span class="attr">&quot;topic&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;payload&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;payloadType&quot;</span><span class="punctuation">:</span><span class="string">&quot;date&quot;</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">180</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">100</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="string">&quot;23b56d4e8c55a864&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;134258e1d6cb1824&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;influxdb batch&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;influxdb&quot;</span><span class="punctuation">:</span><span class="string">&quot;ed5228586bb6bef2&quot;</span><span class="punctuation">,</span><span class="attr">&quot;precision&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;retentionPolicy&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;database&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;retentionPolicyV18Flux&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;org&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;bucket&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">840</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">340</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;9276fc288ef9b7da&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;function&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;func&quot;</span><span class="punctuation">:</span><span class="string">&quot;var value_tmp = msg.payload;\nvar measurement_tmp = msg.measurement;\nvar friendly_name_str_tmp = msg.name;\nfriendly_name_str_tmp=friendly_name_str_tmp.replace(/ +/g, &#x27;_&#x27;); \nvar entity_id_tmp = friendly_name_str_tmp.toLowerCase();\n//var entity_id_tmp = msg.entity_id;\n//var friendly_name_str_tmp = entity_id_tmp;\n\n//default\nvar device_class_str_tmp = \&quot;\&quot;;\nvar domain_tmp = \&quot;sensor\&quot;;\nvar state_class_str_tmp = \&quot;measurement\&quot;;\n    \nif(measurement_tmp == \&quot;V\&quot;)&#123;\n    device_class_str_tmp = \&quot;voltage\&quot;;\n    domain_tmp = \&quot;sensor\&quot;;\n    state_class_str_tmp = \&quot;measurement\&quot;;\n&#125;\nif(measurement_tmp == \&quot;A\&quot;)&#123;\n    device_class_str_tmp = \&quot;current\&quot;;\n    domain_tmp = \&quot;sensor\&quot;;\n    state_class_str_tmp = \&quot;measurement\&quot;;\n&#125;\nif(measurement_tmp == \&quot;W\&quot;)&#123;\n    device_class_str_tmp = \&quot;power\&quot;;\n    domain_tmp = \&quot;sensor\&quot;;\n    state_class_str_tmp = \&quot;measurement\&quot;;\n&#125;\nif(measurement_tmp == \&quot;kWh\&quot;)&#123;\n    device_class_str_tmp = \&quot;energy\&quot;;\n    domain_tmp = \&quot;sensor\&quot;;\n    state_class_str_tmp = \&quot;total_increasing\&quot;;\n&#125;\nif(measurement_tmp == \&quot;pf\&quot;)&#123;\n    measurement_tmp = \&quot;state\&quot;\n    device_class_str_tmp = \&quot;power_factor\&quot;;\n    domain_tmp = \&quot;sensor\&quot;;\n    state_class_str_tmp = \&quot;measurement\&quot;;\n&#125;\nif(measurement_tmp == \&quot;Hz\&quot;)&#123;\n    device_class_str_tmp = \&quot;frequency\&quot;;\n    domain_tmp = \&quot;sensor\&quot;;\n    state_class_str_tmp = \&quot;measurement\&quot;;\n&#125;\nif(measurement_tmp == \&quot;\&quot;)&#123;\n    measurement_tmp = \&quot;state\&quot;\n    device_class_str_tmp = \&quot;\&quot;;\n    domain_tmp = \&quot;sensor\&quot;;\n    state_class_str_tmp = \&quot;measurement\&quot;;\n&#125;\nif(measurement_tmp == undefined)&#123;\n    measurement_tmp = \&quot;state\&quot;\n    device_class_str_tmp = \&quot;\&quot;;\n    domain_tmp = \&quot;sensor\&quot;;\n    state_class_str_tmp = \&quot;measurement\&quot;;\n&#125;\n\nmsg.payload = [\n    &#123;\n        measurement: measurement_tmp,\n        fields: &#123;\n            \&quot;device_class_str\&quot;: device_class_str_tmp,\n            \&quot;friendly_name_str\&quot;: friendly_name_str_tmp,\n            \&quot;state_class_str\&quot;: state_class_str_tmp,\n            \&quot;value\&quot;: value_tmp\n        &#125;,\n        tags:&#123;\n            \&quot;domain\&quot;: domain_tmp,\n            \&quot;entity_id\&quot;: entity_id_tmp\n        &#125;,\n        timestamp: new Date()\n    &#125;\n];\n\nreturn msg;\n&quot;</span><span class="punctuation">,</span><span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;noerr&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;initialize&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;finalize&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;libs&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">590</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">340</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="string">&quot;2554a81894bac719&quot;</span><span class="punctuation">,</span><span class="string">&quot;134258e1d6cb1824&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;4cf70a8d60699c14&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;function&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Voltage&quot;</span><span class="punctuation">,</span><span class="attr">&quot;func&quot;</span><span class="punctuation">:</span><span class="string">&quot;\nmsg.measurement = \&quot;V\&quot;;\nmsg.name = \&quot;Home Meter Voltage\&quot;;\n\nreturn msg;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;noerr&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;initialize&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;finalize&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;libs&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">360</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">180</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="string">&quot;9276fc288ef9b7da&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;2554a81894bac719&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;debug&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;active&quot;</span><span class="punctuation">:</span><span class="keyword">true</span><span class="punctuation">,</span><span class="attr">&quot;tosidebar&quot;</span><span class="punctuation">:</span><span class="keyword">true</span><span class="punctuation">,</span><span class="attr">&quot;console&quot;</span><span class="punctuation">:</span><span class="keyword">false</span><span class="punctuation">,</span><span class="attr">&quot;tostatus&quot;</span><span class="punctuation">:</span><span class="keyword">false</span><span class="punctuation">,</span><span class="attr">&quot;complete&quot;</span><span class="punctuation">:</span><span class="string">&quot;payload&quot;</span><span class="punctuation">,</span><span class="attr">&quot;targetType&quot;</span><span class="punctuation">:</span><span class="string">&quot;msg&quot;</span><span class="punctuation">,</span><span class="attr">&quot;statusVal&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;statusType&quot;</span><span class="punctuation">:</span><span class="string">&quot;auto&quot;</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">750</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">280</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;45a9208a9f8168c4&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;inject&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;props&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;p&quot;</span><span class="punctuation">:</span><span class="string">&quot;payload&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;p&quot;</span><span class="punctuation">:</span><span class="string">&quot;topic&quot;</span><span class="punctuation">,</span><span class="attr">&quot;vt&quot;</span><span class="punctuation">:</span><span class="string">&quot;str&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;repeat&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;crontab&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;once&quot;</span><span class="punctuation">:</span><span class="keyword">false</span><span class="punctuation">,</span><span class="attr">&quot;onceDelay&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;topic&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;payload&quot;</span><span class="punctuation">:</span><span class="string">&quot;230&quot;</span><span class="punctuation">,</span><span class="attr">&quot;payloadType&quot;</span><span class="punctuation">:</span><span class="string">&quot;num&quot;</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">190</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">180</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="string">&quot;4cf70a8d60699c14&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;64f1429aaa46c1f5&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;function&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Current&quot;</span><span class="punctuation">,</span><span class="attr">&quot;func&quot;</span><span class="punctuation">:</span><span class="string">&quot;\nmsg.measurement = \&quot;A\&quot;;\nmsg.name = \&quot;Home Meter Current\&quot;;\n\nreturn msg;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;noerr&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;initialize&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;finalize&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;libs&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">360</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">240</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="string">&quot;9276fc288ef9b7da&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;ad42e8764b77a9f9&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;function&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Power&quot;</span><span class="punctuation">,</span><span class="attr">&quot;func&quot;</span><span class="punctuation">:</span><span class="string">&quot;\nmsg.measurement = \&quot;W\&quot;;\nmsg.name = \&quot;Home Meter Power\&quot;;\n\nreturn msg;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;noerr&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;initialize&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;finalize&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;libs&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">350</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">300</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="string">&quot;9276fc288ef9b7da&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;0984f1e57b29cf17&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;function&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Energy&quot;</span><span class="punctuation">,</span><span class="attr">&quot;func&quot;</span><span class="punctuation">:</span><span class="string">&quot;\nmsg.measurement = \&quot;kWh\&quot;;\nmsg.name = \&quot;Home Meter Energy\&quot;;\n\nreturn msg;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;noerr&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;initialize&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;finalize&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;libs&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">360</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">360</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="string">&quot;9276fc288ef9b7da&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;1e53296af2df1e4d&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;function&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;PF&quot;</span><span class="punctuation">,</span><span class="attr">&quot;func&quot;</span><span class="punctuation">:</span><span class="string">&quot;\nmsg.measurement = \&quot;pf\&quot;;\nmsg.name = \&quot;Home Meter PF\&quot;;\n\nreturn msg;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;noerr&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;initialize&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;finalize&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;libs&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">350</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">420</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="string">&quot;9276fc288ef9b7da&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;69e0cf70c92829f9&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;function&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;Frequency&quot;</span><span class="punctuation">,</span><span class="attr">&quot;func&quot;</span><span class="punctuation">:</span><span class="string">&quot;\nmsg.measurement = \&quot;Hz\&quot;;\nmsg.name = \&quot;Home Meter Frequency\&quot;;\n\nreturn msg;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;noerr&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;initialize&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;finalize&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;libs&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">370</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">480</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="string">&quot;9276fc288ef9b7da&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;9cd9bfcba66aa5ce&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;inject&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;props&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;p&quot;</span><span class="punctuation">:</span><span class="string">&quot;payload&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;p&quot;</span><span class="punctuation">:</span><span class="string">&quot;topic&quot;</span><span class="punctuation">,</span><span class="attr">&quot;vt&quot;</span><span class="punctuation">:</span><span class="string">&quot;str&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;repeat&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;crontab&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;once&quot;</span><span class="punctuation">:</span><span class="keyword">false</span><span class="punctuation">,</span><span class="attr">&quot;onceDelay&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;topic&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;payload&quot;</span><span class="punctuation">:</span><span class="string">&quot;23.6&quot;</span><span class="punctuation">,</span><span class="attr">&quot;payloadType&quot;</span><span class="punctuation">:</span><span class="string">&quot;num&quot;</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">190</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">240</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="string">&quot;64f1429aaa46c1f5&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;c4339117cfad39ab&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;inject&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;props&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;p&quot;</span><span class="punctuation">:</span><span class="string">&quot;payload&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;p&quot;</span><span class="punctuation">:</span><span class="string">&quot;topic&quot;</span><span class="punctuation">,</span><span class="attr">&quot;vt&quot;</span><span class="punctuation">:</span><span class="string">&quot;str&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;repeat&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;crontab&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;once&quot;</span><span class="punctuation">:</span><span class="keyword">false</span><span class="punctuation">,</span><span class="attr">&quot;onceDelay&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;topic&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;payload&quot;</span><span class="punctuation">:</span><span class="string">&quot;1234&quot;</span><span class="punctuation">,</span><span class="attr">&quot;payloadType&quot;</span><span class="punctuation">:</span><span class="string">&quot;num&quot;</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">190</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">300</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="string">&quot;ad42e8764b77a9f9&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;e9f633395adefd98&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;inject&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;props&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;p&quot;</span><span class="punctuation">:</span><span class="string">&quot;payload&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;p&quot;</span><span class="punctuation">:</span><span class="string">&quot;topic&quot;</span><span class="punctuation">,</span><span class="attr">&quot;vt&quot;</span><span class="punctuation">:</span><span class="string">&quot;str&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;repeat&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;crontab&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;once&quot;</span><span class="punctuation">:</span><span class="keyword">false</span><span class="punctuation">,</span><span class="attr">&quot;onceDelay&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;topic&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;payload&quot;</span><span class="punctuation">:</span><span class="string">&quot;632.123&quot;</span><span class="punctuation">,</span><span class="attr">&quot;payloadType&quot;</span><span class="punctuation">:</span><span class="string">&quot;num&quot;</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">200</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">360</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="string">&quot;0984f1e57b29cf17&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;f35c64d4dcc7b5bf&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;inject&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;props&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;p&quot;</span><span class="punctuation">:</span><span class="string">&quot;payload&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;p&quot;</span><span class="punctuation">:</span><span class="string">&quot;topic&quot;</span><span class="punctuation">,</span><span class="attr">&quot;vt&quot;</span><span class="punctuation">:</span><span class="string">&quot;str&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;repeat&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;crontab&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;once&quot;</span><span class="punctuation">:</span><span class="keyword">false</span><span class="punctuation">,</span><span class="attr">&quot;onceDelay&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;topic&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;payload&quot;</span><span class="punctuation">:</span><span class="string">&quot;0.982&quot;</span><span class="punctuation">,</span><span class="attr">&quot;payloadType&quot;</span><span class="punctuation">:</span><span class="string">&quot;num&quot;</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">190</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">420</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="string">&quot;1e53296af2df1e4d&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;ca7506d0e53deb88&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;inject&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;props&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;p&quot;</span><span class="punctuation">:</span><span class="string">&quot;payload&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;p&quot;</span><span class="punctuation">:</span><span class="string">&quot;topic&quot;</span><span class="punctuation">,</span><span class="attr">&quot;vt&quot;</span><span class="punctuation">:</span><span class="string">&quot;str&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;repeat&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;crontab&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;once&quot;</span><span class="punctuation">:</span><span class="keyword">false</span><span class="punctuation">,</span><span class="attr">&quot;onceDelay&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;topic&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;payload&quot;</span><span class="punctuation">:</span><span class="string">&quot;49.99&quot;</span><span class="punctuation">,</span><span class="attr">&quot;payloadType&quot;</span><span class="punctuation">:</span><span class="string">&quot;num&quot;</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">190</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">480</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="string">&quot;69e0cf70c92829f9&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;c58c3f435f1c7645&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;function&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;state&quot;</span><span class="punctuation">,</span><span class="attr">&quot;func&quot;</span><span class="punctuation">:</span><span class="string">&quot;\n//msg.measurement = \&quot;\&quot;;\nmsg.name = \&quot;Home Meter State\&quot;;\n\nreturn msg;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;outputs&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;noerr&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;initialize&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;finalize&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;libs&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">350</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">540</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="string">&quot;9276fc288ef9b7da&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;cd7f37a4727c0acf&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;inject&quot;</span><span class="punctuation">,</span><span class="attr">&quot;z&quot;</span><span class="punctuation">:</span><span class="string">&quot;06263bcac5a42fd1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;props&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;p&quot;</span><span class="punctuation">:</span><span class="string">&quot;payload&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;p&quot;</span><span class="punctuation">:</span><span class="string">&quot;topic&quot;</span><span class="punctuation">,</span><span class="attr">&quot;vt&quot;</span><span class="punctuation">:</span><span class="string">&quot;str&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;repeat&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;crontab&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;once&quot;</span><span class="punctuation">:</span><span class="keyword">false</span><span class="punctuation">,</span><span class="attr">&quot;onceDelay&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;topic&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;payload&quot;</span><span class="punctuation">:</span><span class="string">&quot;66&quot;</span><span class="punctuation">,</span><span class="attr">&quot;payloadType&quot;</span><span class="punctuation">:</span><span class="string">&quot;num&quot;</span><span class="punctuation">,</span><span class="attr">&quot;x&quot;</span><span class="punctuation">:</span><span class="number">190</span><span class="punctuation">,</span><span class="attr">&quot;y&quot;</span><span class="punctuation">:</span><span class="number">540</span><span class="punctuation">,</span><span class="attr">&quot;wires&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">[</span><span class="string">&quot;c58c3f435f1c7645&quot;</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;ed5228586bb6bef2&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;influxdb&quot;</span><span class="punctuation">,</span><span class="attr">&quot;hostname&quot;</span><span class="punctuation">:</span><span class="string">&quot;192.168.12.99&quot;</span><span class="punctuation">,</span><span class="attr">&quot;port&quot;</span><span class="punctuation">:</span><span class="string">&quot;8086&quot;</span><span class="punctuation">,</span><span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span><span class="string">&quot;http&quot;</span><span class="punctuation">,</span><span class="attr">&quot;database&quot;</span><span class="punctuation">:</span><span class="string">&quot;homeassistant&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;usetls&quot;</span><span class="punctuation">:</span><span class="keyword">false</span><span class="punctuation">,</span><span class="attr">&quot;tls&quot;</span><span class="punctuation">:</span><span class="string">&quot;dcf827c4.19bc58&quot;</span><span class="punctuation">,</span><span class="attr">&quot;influxdbVersion&quot;</span><span class="punctuation">:</span><span class="string">&quot;1.x&quot;</span><span class="punctuation">,</span><span class="attr">&quot;url&quot;</span><span class="punctuation">:</span><span class="string">&quot;http://localhost:8086&quot;</span><span class="punctuation">,</span><span class="attr">&quot;rejectUnauthorized&quot;</span><span class="punctuation">:</span><span class="keyword">true</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="string">&quot;dcf827c4.19bc58&quot;</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="string">&quot;tls-config&quot;</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;cert&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;key&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;ca&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;certname&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;keyname&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;caname&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;servername&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span><span class="attr">&quot;verifyservercert&quot;</span><span class="punctuation">:</span><span class="keyword">false</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p><img src="./image-20220529223513196.png" alt="image-20220529223513196"></p>
<p>然后就可以在你的grafana里看到对应的数据了:</p>
<p><img src="./image-20220529223708762.png" alt="image-20220529223708762"></p>
]]></content>
      <categories>
        <category>Smart Home</category>
      </categories>
      <tags>
        <tag>nodered</tag>
        <tag>influxdb</tag>
      </tags>
  </entry>
  <entry>
    <title>Win10微软输⼊法快速输⼊当前时间</title>
    <url>/2022/05/29/win10_shuru_sj/</url>
    <content><![CDATA[<h1 id="Win11微软输入法快速输入当前时间"><a href="#Win11微软输入法快速输入当前时间" class="headerlink" title="Win11微软输入法快速输入当前时间"></a>Win11微软输入法快速输入当前时间</h1><p>右键微软输⼊法，选择“设置”；</p>
<p><img src="./image-20220529221320919.png" alt="image-20220529221320919"></p>
<p>选择”词库和自学习”:</p>
<p><img src="./image-20220529221525398.png" alt="image-20220529221525398"></p>
<p>找到“用户定义的短语”，点击“添加或编辑⾃定义短语”；</p>
<p><img src="./image-20220529221711771.png" alt="image-20220529221711771"></p>
<p>点击“添加”，添加自定义短语；</p>
<p><img src="./image-20220529221828198.png" alt="image-20220529221828198"></p>
<p>输入自定义快捷拼⾳，“短语”需要输⼊以下代码，也可以自定义输出格式；</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">%yyyy%-%MM%-%dd% %HH%:%mm%:%ss%</span><br><span class="line">%yyyy%%MM%%dd%_%HH%%mm%%ss%</span><br></pre></td></tr></table></figure>

<p><img src="./image-20220529222033573.png" alt="image-20220529222033573"></p>
<p>最后，点击“添加”即可，也可通过同样的方式添加地址等，十分方便。</p>
<h2 id=""><a href="#" class="headerlink" title=""></a></h2>]]></content>
      <categories>
        <category>小技巧</category>
      </categories>
      <tags>
        <tag>输入法</tag>
        <tag>当前时间</tag>
      </tags>
  </entry>
</search>
